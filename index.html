<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="utf-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1">
Â  <title>Hubstaff Log Analyzer v33</title>
Â  <style>
Â  Â  :root {
Â  Â  Â  --bg: #0f172a; --panel: #111827; --card: #0b1220; --text: #e5e7eb;
Â  Â  Â  --muted: #9ca3af; --accent: #22c55e; --warn: #f59e0b; --danger: #ef4444;
Â  Â  Â  --resume: #818cf8; --discard: #6b7280; --border: #1f2937; --link: #3b82f6;
Â  Â  }
Â  Â  * { box-sizing: border-box; margin: 0; padding: 0; }
Â  Â  body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }
Â  Â  
Â  Â  header { padding: 20px; border-bottom: 1px solid var(--border); background: var(--panel); }
Â  Â  header h1 { font-size: 18px; margin-bottom: 4px; }
Â  Â  header p { font-size: 12px; color: var(--muted); }
Â  Â  
Â  Â  main { padding: 16px; max-width: 1400px; margin: 0 auto; }
Â  Â  
Â  Â  .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 16px; margin-bottom: 16px; }
Â  Â  
Â  Â  .controls { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; margin-bottom: 12px; }
Â  Â  
Â  Â  button { background: var(--panel); color: var(--text); border: 1px solid var(--border); border-radius: 8px; padding: 8px 14px; font-size: 13px; font-weight: 600; cursor: pointer; }
Â  Â  button:hover { border-color: #374151; }
Â  Â  button.primary { background: #1e40af; border-color: #1e40af; }
Â  Â  
Â  Â  textarea { width: 100%; height: 120px; background: #030712; color: var(--text); border: 1px solid var(--border); border-radius: 8px; padding: 12px; font-family: monospace; font-size: 12px; resize: vertical; }
Â  Â  
Â  Â  .status { font-size: 12px; color: var(--muted); margin-left: 8px; }
Â  Â  .status.success { color: var(--accent); }
Â  Â  .status.error { color: var(--danger); }
Â  Â  
Â  Â  .toggle-row { display: flex; align-items: center; gap: 16px; margin-top: 10px; font-size: 13px; color: var(--muted); flex-wrap: wrap; }
Â  Â  .tz-input-group { display: flex; align-items: center; gap: 6px; padding-left: 12px; border-left: 1px solid var(--border); }
Â  Â  .tz-input-group input { width: 100px; background: var(--panel); border: 1px solid var(--border); border-radius: 4px; padding: 4px 8px; color: var(--text); font-size: 12px; }
Â  Â  .toggle-row label { display: flex; align-items: center; gap: 6px; cursor: pointer; }
Â  Â  .help-link { color: var(--accent); text-decoration: underline; cursor: pointer; margin-left: auto; }
Â  Â  
Â  Â  .kpis { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-bottom: 16px; }
Â  Â  .kpi { background: var(--panel); border: 1px solid var(--border); border-radius: 10px; padding: 14px; }
Â  Â  .kpi-label { font-size: 11px; color: var(--muted); font-weight: 600; margin-bottom: 6px; }
Â  Â  .kpi-value { font-size: 22px; font-weight: 700; }
Â  Â  .kpi-note { font-size: 10px; color: var(--warn); margin-top: 4px; }
Â  Â  
Â  Â  .section-title { font-size: 13px; color: var(--muted); margin-bottom: 10px; font-weight: 600; }
Â  Â  
Â  Â  .table-wrap { max-height: 250px; overflow: auto; border: 1px solid var(--border); border-radius: 8px; }
Â  Â  table { width: 100%; border-collapse: collapse; font-size: 12px; }
Â  Â  th, td { padding: 8px 10px; text-align: left; border-bottom: 1px solid var(--border); }
Â  Â  th { background: var(--panel); color: var(--muted); font-weight: 600; position: sticky; top: 0; }
Â  Â  tr:last-child td { border-bottom: none; }
Â  Â  tr.highlight { background: rgba(34,197,94,0.2) !important; }
Â  Â  tr.highlight td { color: #fff; font-weight: 600; }
Â  Â  
Â  Â  .tag { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; }
Â  Â  .tag.ok { background: rgba(34,197,94,0.15); color: var(--accent); }
Â  Â  .tag.warn { background: rgba(245,158,11,0.15); color: var(--warn); }
Â  Â  .tag.danger { background: rgba(239,68,68,0.15); color: var(--danger); }
Â  Â  .tag.resume { background: rgba(129,140,248,0.15); color: var(--resume); }
Â  Â  
Â  Â  .time-link { color: var(--link); cursor: pointer; text-decoration: none; font-weight: 600; }
Â  Â  .time-link:hover { text-decoration: underline; }
Â  Â  
Â  Â  .timeline-section { display: none; }
Â  Â  .timeline-section.visible { display: block; }
Â  Â  
Â  Â  .timeline-header { display: flex; align-items: center; gap: 16px; margin-bottom: 12px; flex-wrap: wrap; }
Â  Â  .timeline-legend { font-size: 11px; color: var(--muted); display: flex; gap: 12px; flex-wrap: wrap; }
Â  Â  .timeline-legend span { display: flex; align-items: center; gap: 4px; }
Â  Â  .legend-box { width: 12px; height: 12px; border-radius: 2px; }
Â  Â  
Â  Â  .zoom-controls { display: flex; align-items: center; gap: 8px; margin-left: auto; background: var(--panel); padding: 6px 12px; border-radius: 6px; border: 1px solid var(--border); }
Â  Â  .zoom-controls label { font-size: 11px; color: var(--muted); }
Â  Â  .zoom-controls input[type=range] { width: 120px; cursor: pointer; }
Â  Â  .zoom-controls button { padding: 4px 8px; font-size: 11px; }
Â  Â  
Â  Â  .timeline-container { background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 8px; padding: 16px; overflow-x: auto; position: relative; cursor: crosshair; }
Â  Â  .timeline-content { position: relative; min-width: 100%; }
Â  Â  .timeline-track { position: relative; height: 32px; background: rgba(255,255,255,0.03); border-radius: 4px; margin-bottom: 12px; border: 1px solid var(--border); }
Â  Â  .timeline-label { font-size: 10px; color: var(--muted); margin-bottom: 4px; font-weight: 600; text-transform: uppercase; }
Â  Â  
Â  Â  .t-block { position: absolute; height: 32px; border-radius: 3px; min-width: 3px; cursor: pointer; transition: opacity 0.15s; z-index: 10; }
Â  Â  .t-block:hover { opacity: 0.75; }
Â  Â  .t-block.selected { box-shadow: 0 0 0 2px #fff, 0 0 12px rgba(255,255,255,0.5); z-index: 20; }
Â  Â  .t-block.USER { background: var(--accent); }
Â  Â  .t-block.IDLE { background: var(--warn); }
Â  Â  .t-block.RESUMED { background: var(--resume); box-shadow: inset 0 0 0 2px rgba(255,255,255,0.3); }
Â  Â  .t-block.DISCARDED { background: repeating-linear-gradient(45deg, var(--discard), var(--discard) 4px, rgba(107,114,128,0.4) 4px, rgba(107,114,128,0.4) 8px); }
Â  Â  .t-block.CONFIG_STOPPED { background: linear-gradient(90deg, var(--accent) 0%, var(--accent) 85%, var(--danger) 85%, var(--danger) 100%); }
Â  Â  
Â  Â  .t-marker { position: absolute; top: 50%; transform: translate(-50%, -50%); font-size: 14px; cursor: pointer; z-index: 10; }
Â  Â  .t-marker:hover { transform: translate(-50%, -50%) scale(1.3); }
Â  Â  .t-marker.selected { background: rgba(255,255,255,0.2); border-radius: 50%; padding: 2px; }
Â  Â  .t-marker.clean { color: var(--accent); }
Â  Â  .t-marker.crash { color: var(--danger); }
Â  Â  .t-marker.shutdown { color: var(--muted); }
Â  Â  
Â  Â  .timeline-cursor { position: absolute; top: 0; bottom: 0; width: 2px; background: var(--danger); z-index: 5; display: none; pointer-events: none; box-shadow: 0 0 6px var(--danger); }
Â  Â  
Â  Â  .info-box { position: absolute; background: var(--panel); border: 1px solid var(--accent); border-radius: 10px; padding: 14px; z-index: 1000; display: none; box-shadow: 0 10px 40px rgba(0,0,0,0.6); min-width: 220px; max-width: 300px; }
Â  Â  .info-box h4 { color: var(--accent); font-size: 13px; margin-bottom: 8px; padding-bottom: 6px; border-bottom: 1px solid var(--border); }
Â  Â  .info-box p { font-size: 12px; color: var(--text); margin: 4px 0; line-height: 1.5; }
Â  Â  .info-box .label { color: var(--muted); }
Â  Â  .info-box .touch-link { color: var(--link); text-decoration: underline; cursor: pointer; font-size: 11px; margin-top: 8px; display: inline-block; }
Â  Â  
Â  Â  .warnings-list { list-style: none; padding-left: 0; }
Â  Â  .warnings-list li { padding: 10px 0; font-size: 12px; color: var(--text); border-bottom: 1px dashed var(--border); line-height: 1.6; }
Â  Â  .warnings-list li:last-child { border-bottom: none; }
Â  Â  .learn-more-btn { background: var(--link); border: none; color: #fff; padding: 3px 10px; border-radius: 4px; font-size: 11px; cursor: pointer; margin-left: 10px; vertical-align: middle; }
Â  Â  .learn-more-btn:hover { background: #2563eb; }
Â  Â  
Â  Â  .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.75); z-index: 1001; align-items: center; justify-content: center; }
Â  Â  .modal-overlay.visible { display: flex; }
Â  Â  .modal { background: var(--bg); border: 1px solid var(--border); border-radius: 12px; width: 90%; max-width: 800px; max-height: 85vh; overflow-y: auto; padding: 24px; }
Â  Â  .modal h2 { color: var(--accent); margin-bottom: 16px; font-size: 18px; }
Â  Â  .modal h3 { color: var(--warn); margin: 20px 0 10px; font-size: 14px; border-bottom: 1px solid var(--border); padding-bottom: 6px; }
Â  Â  .modal p, .modal li { font-size: 13px; color: var(--muted); line-height: 1.6; margin-bottom: 8px; }
Â  Â  .modal code { background: var(--card); padding: 2px 6px; border-radius: 4px; font-size: 12px; color: var(--accent); }
Â  Â  .modal .callout { background: rgba(245,158,11,0.1); border-left: 3px solid var(--warn); padding: 12px; border-radius: 0 8px 8px 0; margin: 12px 0; }
Â  Â  .modal .tech-box { background: rgba(129,140,248,0.1); border: 1px solid rgba(129,140,248,0.3); border-radius: 8px; padding: 16px; margin-top: 20px; }
Â  Â  .modal .tech-box h4 { color: var(--resume); margin: 0 0 10px 0; font-size: 13px; }
Â  Â  .close-btn { float: right; background: var(--panel); border: 1px solid var(--border); color: var(--text); padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; }
Â  Â  
Â  Â  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
Â  Â  @media (max-width: 900px) { .grid-2 { grid-template-columns: 1fr; } }
Â  Â  .event-card { background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 10px; margin-bottom: 8px; }
Â  Â  .event-card h5 { margin: 0 0 4px; font-size: 12px; color: var(--text); }
Â  Â  .event-card p { margin: 0; font-size: 11px; }
Â  Â  .event-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
Â  Â  @media (max-width: 600px) { .event-grid { grid-template-columns: 1fr; } }
Â  </style>
</head>
<body>
Â  <header>
Â  Â  <h1>Hubstaff Audit Log Analyzer (v33)</h1>
Â  Â  <p>Analyze audit.log files to understand tracking sessions, crashes, idle time, and more.</p>
Â  Â  <p style="font-size:11px; color:var(--accent); margin-top:4px;">ğŸ”’ Privacy: All analysis happens in your browser. No data is sent to any server.</p>
Â  </header>
Â  
Â  <main>
Â  Â  <div class="card">
Â  Â  Â  <div class="controls">
Â  Â  Â  Â  <button class="primary" id="analyzeBtn">Analyze</button>
Â  Â  Â  Â  <button id="sampleBtn">Sample: Crash Recovered</button>
Â  Â  Â  Â  <button id="sampleLostBtn">Sample: Time Lost</button>
Â  Â  Â  Â  <button id="clearBtn">Clear</button>
Â  Â  Â  Â  <span class="status" id="status"></span>
Â  Â  Â  </div>
Â  Â  Â  <textarea id="logInput" placeholder="Paste audit.log contents here..."></textarea>
Â  Â  Â  <div class="toggle-row">
Â  Â  Â  Â  <label><input type="checkbox" id="plainMode" checked> Plain English mode</label>
Â  Â  Â  Â  <label><input type="checkbox" id="userTzMode"> Show user's timezone</label>
Â  Â  Â  Â  <div class="tz-input-group">
Â  Â  Â  Â  Â  Â  <input type="text" id="tzOffset" placeholder="e.g. 08:00:00">
Â  Â  Â  Â  Â  Â  <span id="tzLabel" style="font-size:11px"></span>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <span class="help-link" id="helpBtn">Help & Info</span>
Â  Â  Â  </div>
Â  Â  </div>
Â  Â  
Â  Â  <div class="kpis">
Â  Â  Â  <div class="kpi">
Â  Â  Â  Â  <div class="kpi-label">Tracked Time (est.)</div>
Â  Â  Â  Â  <div class="kpi-value" id="kpiTotal">0:00:00</div>
Â  Â  Â  Â  <div class="kpi-note">â„¹ï¸ May differ slightly from dashboard</div>
Â  Â  Â  </div>
Â  Â  Â  <div class="kpi">
Â  Â  Â  Â  <div class="kpi-label">Intervals</div>
Â  Â  Â  Â  <div class="kpi-value" id="kpiIntervals">0</div>
Â  Â  Â  </div>
Â  Â  Â  <div class="kpi">
Â  Â  Â  Â  <div class="kpi-label">Idle Kept</div>
Â  Â  Â  Â  <div class="kpi-value" id="kpiIdleKept">0:00:00</div>
Â  Â  Â  </div>
Â  Â  Â  <div class="kpi">
Â  Â  Â  Â  <div class="kpi-label">Idle Discarded</div>
Â  Â  Â  Â  <div class="kpi-value" id="kpiIdleDisc">0:00:00</div>
Â  Â  Â  </div>
Â  Â  Â  <div class="kpi">
Â  Â  Â  Â  <div class="kpi-label">Warnings</div>
Â  Â  Â  Â  <div class="kpi-value" id="kpiWarnings">0</div>
Â  Â  Â  </div>
Â  Â  </div>
Â  Â  
Â  Â  <div class="card timeline-section" id="timelineSection">
Â  Â  Â  <div class="timeline-header">
Â  Â  Â  Â  <div class="section-title" style="margin:0;">Visual Timeline</div>
Â  Â  Â  Â  <div class="timeline-legend">
Â  Â  Â  Â  Â  <span><div class="legend-box" style="background:var(--accent)"></div> Tracking</span>
Â  Â  Â  Â  Â  <span><div class="legend-box" style="background:var(--warn)"></div> Idle</span>
Â  Â  Â  Â  Â  <span><div class="legend-box" style="background:var(--discard)"></div> Discarded</span>
Â  Â  Â  Â  Â  <span><div class="legend-box" style="background:var(--resume)"></div> Resumed</span>
Â  Â  Â  Â  Â  <span><div class="legend-box" style="background:linear-gradient(90deg, var(--accent) 60%, var(--danger) 60%)"></div> Config Stop</span>
Â  Â  Â  Â  Â  <span style="color:var(--accent)">â—</span><span>Start</span>
Â  Â  Â  Â  Â  <span style="color:var(--danger)">âœ–</span><span>Crash</span>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="zoom-controls">
Â  Â  Â  Â  Â  <label>Zoom:</label>
Â  Â  Â  Â  Â  <input type="range" id="zoomSlider" min="1" max="30" value="1" step="0.5">
Â  Â  Â  Â  Â  <button id="resetZoom">Reset</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  <div class="timeline-container" id="timelineContainer">
Â  Â  Â  Â  <div class="timeline-content" id="timelineContent">
Â  Â  Â  Â  Â  <div class="timeline-cursor" id="timelineCursor"></div>
Â  Â  Â  Â  Â  <div class="timeline-label">Tracking</div>
Â  Â  Â  Â  Â  <div class="timeline-track" id="trackMain"></div>
Â  Â  Â  Â  Â  <div class="timeline-label">App Events</div>
Â  Â  Â  Â  Â  <div class="timeline-track" id="trackEvents"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  Â  
Â  Â  <div class="grid-2">
Â  Â  Â  <div class="card">
Â  Â  Â  Â  <div class="section-title">Interval Breakdown</div>
Â  Â  Â  Â  <div class="table-wrap">
Â  Â  Â  Â  Â  <table>
Â  Â  Â  Â  Â  Â  <thead><tr><th>#</th><th>Start</th><th>Stop</th><th>Duration</th><th>Stop Reason</th></tr></thead>
Â  Â  Â  Â  Â  Â  <tbody id="intervalsBody"></tbody>
Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  
Â  Â  Â  <div class="card">
Â  Â  Â  Â  <div class="section-title">Events & Warnings</div>
Â  Â  Â  Â  <div class="table-wrap">
Â  Â  Â  Â  Â  <table>
Â  Â  Â  Â  Â  Â  <thead><tr><th>Time</th><th>Event</th><th>Details</th></tr></thead>
Â  Â  Â  Â  Â  Â  <tbody id="eventsBody"></tbody>
Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div style="margin-top:12px;">
Â  Â  Â  Â  Â  <div class="section-title">Parsing Warnings</div>
Â  Â  Â  Â  Â  <ul class="warnings-list" id="warningsList"><li style="color:var(--muted)">No warnings</li></ul>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  <footer style="text-align:center; padding:20px; border-top:1px solid var(--border); margin-top:20px; font-size:12px; color:var(--muted);">
Â  Â  Â  <span>Hubstaff Log Analyzer v33</span>
Â  Â  Â  <span style="margin:0 10px;">|</span>
Â  Â  Â  <span class="help-link" id="privacyBtn">ğŸ”’ Privacy Info</span>
Â  Â  </footer>
Â  </main>
Â  
Â  <div class="modal-overlay" id="privacyModal">
Â  Â  <div class="modal" style="max-width:550px;">
Â  Â  Â  <button class="close-btn" id="closePrivacy">Close</button>
Â  Â  Â  <h2>ğŸ”’ Privacy & Data Security</h2>
Â  Â  Â  
Â  Â  Â  <h3>Your data stays on your device</h3>
Â  Â  Â  <p>This tool runs <strong>entirely in your web browser</strong>. When you paste log data:</p>
Â  Â  Â  <ul>
Â  Â  Â  Â  <li>âœ… Data is processed locally on your computer</li>
Â  Â  Â  Â  <li>âœ… Nothing is sent to any server</li>
Â  Â  Â  Â  <li>âœ… No data is stored in cookies or browser storage</li>
Â  Â  Â  Â  <li>âœ… No tracking or analytics</li>
Â  Â  Â  </ul>
Â  Â  Â  
Â  Â  Â  <h3>What happens when you click "Clear"</h3>
Â  Â  Â  <ul>
Â  Â  Â  Â  <li>The text input is emptied</li>
Â  Â  Â  Â  <li>All parsed data is overwritten in memory</li>
Â  Â  Â  Â  <li>All displayed results are removed</li>
Â  Â  Â  Â  <li>A confirmation message appears</li>
Â  Â  Â  </ul>
Â  Â  Â  
Â  Â  Â  <h3>What happens when you close the page</h3>
Â  Â  Â  <ul>
Â  Â  Â  Â  <li>All data is automatically cleared</li>
Â  Â  Â  Â  <li>Nothing persists after you leave</li>
Â  Â  Â  Â  <li>No data remains in browser history</li>
Â  Â  Â  </ul>
Â  Â  Â  
Â  Â  Â  <h3>Best practices</h3>
Â  Â  Â  <ul>
Â  Â  Â  Â  <li>Click <strong>"Clear"</strong> when you're done analyzing</li>
Â  Â  Â  Â  <li>Close the browser tab when finished</li>
Â  Â  Â  Â  <li>Avoid sharing screenshots that show email addresses</li>
Â  Â  Â  </ul>
Â  Â  Â  
Â  Â  Â  <div style="background:rgba(34,197,94,0.1); border:1px solid var(--accent); border-radius:8px; padding:12px; margin-top:16px;">
Â  Â  Â  Â  <p style="margin:0; color:var(--accent);"><strong>âœ… Safe to use with sensitive logs</strong></p>
Â  Â  Â  Â  <p style="margin:8px 0 0 0; font-size:12px;">This tool is designed for support teams handling customer data. Your logs never leave your browser.</p>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>
Â  
Â  <div class="info-box" id="infoBox">
Â  Â  <h4 id="infoTitle">Details</h4>
Â  Â  <div id="infoContent"></div>
Â  </div>
Â  
Â  <div class="modal-overlay" id="helpModal">
Â  Â  <div class="modal">
Â  Â  Â  <button class="close-btn" id="closeHelp">Close</button>
Â  Â  Â  <h2>ğŸ“Š Log Analyzer Help</h2>
Â  Â  Â  
Â  Â  Â  <h3>1. About "Tracked Time (est.)"</h3>
Â  Â  Â  <p>This time is calculated from when the user clicked <strong>Start</strong> and <strong>Stop</strong>.</p>
Â  Â  Â  <div class="callout">
Â  Â  Â  Â  <strong>ğŸ’¡ Why might the dashboard show different time?</strong><br>
Â  Â  Â  Â  The dashboard may differ by 1-2 minutes. This is normal - it's how Hubstaff calculates time internally. Small differences are expected and nothing is wrong.
Â  Â  Â  </div>
Â  Â  Â  
Â  Â  Â  <h3>2. Common Events Explained</h3>
Â  Â  Â  <div class="event-grid">
Â  Â  Â  Â  <div class="event-card"><h5>START_TRACKING by [USER]</h5><p>User clicked Start button.</p></div>
Â  Â  Â  Â  <div class="event-card"><h5>STOP_TRACKING by [USER]</h5><p>User clicked Stop button.</p></div>
Â  Â  Â  Â  <div class="event-card"><h5>by [RESUMED]</h5><p>Time recovered after crash.</p></div>
Â  Â  Â  Â  <div class="event-card"><h5>by [IDLE]</h5><p>Stopped due to idle timeout.</p></div>
Â  Â  Â  Â  <div class="event-card"><h5>STARTUP_CLEAN</h5><p>App opened normally.</p></div>
Â  Â  Â  Â  <div class="event-card"><h5>STARTUP_UNCLEAN</h5><p>App opened after crash/force quit.</p></div>
Â  Â  Â  Â  <div class="event-card"><h5>KeepIdle: 1</h5><p>User kept idle time.</p></div>
Â  Â  Â  Â  <div class="event-card"><h5>StopTracking: 1</h5><p>User discarded idle time.</p></div>
Â  Â  Â  </div>
Â  Â  Â  
Â  Â  Â  <h3>3. Understanding Crashes</h3>
Â  Â  Â  <p>When you see <strong>STARTUP_UNCLEAN</strong>, it means the app restarted after a crash. Look for <strong>RESUME_DETECTED</strong> next - this means time was recovered.</p>
Â  Â  Â  <p><strong>Note:</strong> Time won't auto-resume if more than 1 hour passed (8 hours on mobile).</p>
Â  Â  Â  
Â  Â  Â  <h3>4. Warning Signs</h3>
Â  Â  Â  <p><strong>Unclosed START:</strong> Timer started but never stopped - usually means a crash.</p>
Â  Â  Â  <p><strong>Two STARTs in a row:</strong> Tracking loop crashed while app was still running.</p>
Â  Â  Â  
Â  Â  Â  <h3>5. Using the Timeline</h3>
Â  Â  Â  <p><strong>Click any bar</strong> to see details and highlight the matching row in the table.</p>
Â  Â  Â  <p><strong>Use the zoom slider</strong> to expand the timeline for more detail.</p>
Â  Â  Â  <p><strong>Click empty space</strong> to place a red cursor line.</p>
Â  Â  Â  
Â  Â  Â  <div class="tech-box">
Â  Â  Â  Â  <h4>ğŸ”§ Technical Details (for Tech Team)</h4>
Â  Â  Â  Â  <p>The audit log records event timestamps. The dashboard uses slot-based calculations (10-minute slots). Expected variance: 0-120 seconds.</p>
Â  Â  Â  Â  <p>For exact time, search <code>hubstaff.log</code> for: <code>Applied activity. Total:</code></p>
Â  Â  Â  </div>
Â  Â  Â  
Â  Â  Â  <h3>7. How The Analyzer Works (Technical Reference)</h3>
Â  Â  Â  <p><em>This section documents the logic used to calculate all values. Useful for debugging if the analyzer shows unexpected results.</em></p>
Â  Â  Â  
Â  Â  Â  <h4>ğŸ“Š Tracked Time (est.) - Interval Logic</h4>
Â  Â  Â  <p>An <strong>interval</strong> is defined as a pair of one <code>(START_TRACKING)</code> event and the very next <code>(STOP_TRACKING)</code> or <code>(SHUTDOWN)</code> event.</p>
Â  Â  Â  <ol>
Â  Â  Â  Â  <li>All log lines are parsed and sorted by timestamp</li>
Â  Â  Â  Â  <li>The analyzer loops through looking for <code>START_TRACKING</code> events</li>
Â  Â  Â  Â  <li>When found, it's held in memory as an "open start"</li>
Â  Â  Â  Â  <li>Continue until finding <code>STOP_TRACKING</code> or <code>SHUTDOWN</code></li>
Â  Â  Â  Â  <li>Calculate duration between start and stop timestamps</li>
Â  Â  Â  Â  <li>Save the completed interval, then look for the next start</li>
Â  Â  Â  </ol>
Â  Â  Â  <p><strong>"Tracked Time (est.)"</strong> is the sum of all interval durations.</p>
Â  Â  Â  
Â  Â  Â  <h4>ğŸ”„ Crash & Resume Logic</h4>
Â  Â  Â  <p>This corrects inaccurate timestamps that occur after app crashes:</p>
Â  Â  Â  <ol>
Â  Â  Â  Â  <li>When the parser finds a <code>(RESUME_DETECTED)</code> event, it extracts and stores the original <code>Start time:</code> from the log message</li>
Â  Â  Â  Â  <li>It then looks for the <code>(START_TRACKING) ... by [RESUMED]</code> event that immediately follows</li>
Â  Â  Â  Â  <li>The analyzer <strong>discards</strong> the timestamp from the <code>by [RESUMED]</code> line and <strong>substitutes</strong> the original start time from <code>RESUME_DETECTED</code></li>
Â  Â  Â  Â  <li>This corrected START event (with the earlier, accurate timestamp) is used to start the interval</li>
Â  Â  Â  </ol>
Â  Â  Â  <p><strong>Resume limits:</strong> Time won't auto-resume if more than 1 hour passed (desktop) or 8 hours (mobile). Look for <code>RESUME_IGNORED</code> in these cases.</p>
Â  Â  Â  
Â  Â  Â  <h4>â¸ï¸ Idle Time (Kept / Discarded)</h4>
Â  Â  Â  <ol>
Â  Â  Â  Â  <li>The analyzer loops through all <code>(IDLE_ANSWER)</code> events</li>
Â  Â  Â  Â  <li>For each, it looks <em>backwards</em> to find the most recent <code>(IDLE_WAKE)</code> event that occurred <em>before</em> it</li>
Â  Â  Â  Â  <li>It extracts the <code>after X seconds</code> value from that <code>IDLE_WAKE</code> event</li>
Â  Â  Â  Â  <li>Based on the <code>IDLE_ANSWER</code> flags:
Â  Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  Â  <li><code>KeepIdle: 1</code> â†’ seconds added to "Idle (Kept)" total</li>
Â  Â  Â  Â  Â  Â  <li><code>StopTracking: 1</code> â†’ seconds added to "Idle (Discarded)" total</li>
Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  </li>
Â  Â  Â  </ol>
Â  Â  Â  
Â  Â  Â  <h4>âš ï¸ Warning Detection</h4>
Â  Â  Â  <p>The analyzer detects these patterns:</p>
Â  Â  Â  <ul>
Â  Â  Â  Â  <li><strong>Unclosed START:</strong> A <code>START_TRACKING</code> with no matching <code>STOP_TRACKING</code> before the next START or end of log</li>
Â  Â  Â  Â  <li><strong>Unmatched STOP:</strong> A <code>STOP_TRACKING</code> found when there's no open START being tracked</li>
Â  Â  Â  Â  <li><strong>Quick Start/Stop:</strong> An interval where duration â‰¤ 5 seconds and both start and stop were <code>by [USER]</code></li>
Â  Â  Â  Â  <li><strong>Stopped by Config:</strong> Any interval where stop reason is <code>CONFIGURATION</code></li>
Â  Â  Â  Â  <li><strong>Crash Recovered:</strong> <code>STARTUP_UNCLEAN</code> followed by <code>RESUME_DETECTED</code> within 1 minute</li>
Â  Â  Â  Â  <li><strong>Crash Time Lost:</strong> <code>STARTUP_UNCLEAN</code> followed by <code>RESUME_IGNORED</code>, or crash while tracking with no resume</li>
Â  Â  Â  </ul>
Â  Â  Â  
Â  Â  Â  <h4>ğŸ“ˆ Timeline Visualization</h4>
Â  Â  Â  <p>The timeline plots all intervals and events on a time scale:</p>
Â  Â  Â  <ul>
Â  Â  Â  Â  <li><strong>Time range:</strong> 5 minutes before earliest event to 5 minutes after latest event</li>
Â  Â  Â  Â  <li><strong>Bar position:</strong> <code>((eventTime - minTime) / totalDuration) * 100%</code></li>
Â  Â  Â  Â  <li><strong>Bar color:</strong> Based on <code>startReason</code> (USER=green, IDLE=orange, RESUMED=purple) unless stopped by CONFIGURATION (green with red end)</li>
Â  Â  Â  Â  <li><strong>Markers:</strong> STARTUP_CLEAN (green dot), STARTUP_UNCLEAN (red X), SHUTDOWN (gray dot)</li>
Â  Â  Â  </ul>
Â  Â  Â  
Â  Â  Â  <h4>ğŸ• Timestamp Parsing</h4>
Â  Â  Â  <p>The analyzer handles these timestamp formats:</p>
Â  Â  Â  <ul>
Â  Â  Â  Â  <li><code>2025-12-04 12:39:01.667205+1100</code> (timezone without colon)</li>
Â  Â  Â  Â  <li><code>2025-12-04 12:39:01.667205+11:00</code> (timezone with colon)</li>
Â  Â  Â  Â  <li><code>2025-12-04T12:39:01.667205Z</code> (UTC/Zulu time)</li>
Â  Â  Â  </ul>
Â  Â  Â  <p>All times displayed use the browser's local timezone for readability. <span style="font-style:italic;">(Unless 'Show user's timezone' is checked)</span></p>
Â  Â  </div>
Â  </div>
Â  
Â  <div class="modal-overlay" id="touchModal">
Â  Â  <div class="modal" style="max-width:500px;">
Â  Â  Â  <button class="close-btn" id="closeTouchModal">Close</button>
Â  Â  Â  <h2>Why are these bars touching?</h2>
Â  Â  Â  <p>You're seeing two tracking periods back-to-back with no gap.</p>
Â  Â  Â  <h3>Most Common Reason: Kept Idle Time</h3>
Â  Â  Â  <p>When a user returns from idle and chooses <strong>"Keep idle time"</strong>, two blocks are created:</p>
Â  Â  Â  <p><strong>1.</strong> Active work before going idle (green bar)</p>
Â  Â  Â  <p><strong>2.</strong> The idle time they kept (orange bar)</p>
Â  Â  Â  <div class="callout">
Â  Â  Â  Â  <strong>Is time missing?</strong> No! The bars connect perfectly - all time is accounted for.
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  <div class="modal-overlay" id="learnMoreModal">
Â  Â  <div class="modal" style="max-width:600px;">
Â  Â  Â  <button class="close-btn" id="closeLearnMore">Close</button>
Â  Â  Â  <h2 id="learnMoreTitle">About this warning</h2>
Â  Â  Â  <div id="learnMoreContent"></div>
Â  Â  </div>
Â  </div>

Â  <script>
Â  Â  const $ = id => document.getElementById(id);
Â  Â  const pad = n => String(n).padStart(2, '0');
Â  Â  const fmtTime = s => { s = Math.max(0, Math.floor(s)); return Math.floor(s/3600) + ':' + pad(Math.floor((s%3600)/60)) + ':' + pad(s%60); };
Â  Â  
Â  Â  let result = null;
Â  Â  let selectedEl = null;
Â  Â  let timelineMin = null;
Â  Â  let timelineDur = null;
Â  Â  let focusRatio = null;
Â  Â  let userTzOffsetMs = null;

Â  Â  function parseTzOffset(str) {
Â  Â  Â  if (!str || !str.trim()) return null;
Â  Â  Â  str = str.trim();
Â  Â  Â  let sign = 1;
Â  Â  Â  if (str.startsWith('-')) { sign = -1; str = str.slice(1); }
Â  Â  Â  else if (str.startsWith('+')) { str = str.slice(1); }
Â  Â  Â  let hours = 0, mins = 0;
Â  Â  Â  if (str.includes(':')) {
Â  Â  Â  Â  const parts = str.split(':');
Â  Â  Â  Â  hours = parseInt(parts[0]) || 0;
Â  Â  Â  Â  mins = parseInt(parts[1]) || 0;
Â  Â  Â  } else {
Â  Â  Â  Â  hours = parseFloat(str) || 0;
Â  Â  Â  Â  mins = Math.round((hours - Math.floor(hours)) * 60);
Â  Â  Â  Â  hours = Math.floor(hours);
Â  Â  Â  }
Â  Â  Â  return sign * (hours * 60 + mins) * 60 * 1000;
Â  Â  }

Â  Â  function updateTzLabel() {
Â  Â  Â  const offset = parseTzOffset($('tzOffset').value);
Â  Â  Â  if (offset !== null) {
Â  Â  Â  Â  const hrs = Math.floor(Math.abs(offset) / 3600000);
Â  Â  Â  Â  const mns = Math.floor((Math.abs(offset) % 3600000) / 60000);
Â  Â  Â  Â  const sgn = offset >= 0 ? '+' : '-';
Â  Â  Â  Â  $('tzLabel').textContent = 'UTC' + sgn + hrs + (mns ? ':' + pad(mns) : '');
Â  Â  Â  Â  $('tzLabel').style.color = 'var(--accent)';
Â  Â  Â  Â  userTzOffsetMs = offset;
Â  Â  Â  } else {
Â  Â  Â  Â  $('tzLabel').textContent = $('tzOffset').value ? 'âš ï¸ Invalid' : '';
Â  Â  Â  Â  $('tzLabel').style.color = 'var(--warn)';
Â  Â  Â  Â  userTzOffsetMs = null;
Â  Â  Â  }
Â  Â  }

Â  Â  function fmtTimeWithTz(date) {
Â  Â  Â  if (!date) return '';
Â  Â  Â  if (!$('userTzMode').checked || userTzOffsetMs === null) {
Â  Â  Â  Â  return date.toLocaleTimeString();
Â  Â  Â  }
Â  Â  Â  const utcMs = date.getTime() + date.getTimezoneOffset() * 60 * 1000;
Â  Â  Â  const userDate = new Date(utcMs + userTzOffsetMs);
Â  Â  Â  return userDate.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', second:'2-digit'}) + ' â˜…';
Â  Â  }
Â  Â  
Â  Â  function parseTs(line) {
Â  Â  Â  const m = line.match(/(\d{4}-\d{2}-\d{2})[\sT](\d{2}:\d{2}:\d{2})(?:\.(\d+))?([+-]\d{2}:?\d{2}|Z|\s[+-]\d{4})/);
Â  Â  Â  if (!m) return null;
Â  Â  Â  let tz = m[4].trim();
Â  Â  Â  // Handle +1100 format (no colon)
Â  Â  Â  if (tz.length === 5 && (tz.startsWith('+') || tz.startsWith('-'))) {
Â  Â  Â  Â  tz = tz.slice(0, 3) + ':' + tz.slice(3);
Â  Â  Â  }
Â  Â  Â  const ms = m[3] ? m[3].padEnd(3,'0').slice(0,3) : '000';
Â  Â  Â  const d = new Date(`${m[1]}T${m[2]}.${ms}${tz}`);
Â  Â  Â  return isNaN(d.getTime()) ? null : d;
Â  Â  }
Â  Â  
Â  Â  function parseLine(line) {
Â  Â  Â  const ts = parseTs(line);
Â  Â  Â  let type = null, reason = null, plain = '', secs = null, keepIdle = null, stopTrack = null, resumeStart = null;
Â  Â  Â  
Â  Â  Â  if (line.includes('(START_TRACKING)')) type = 'START_TRACKING';
Â  Â  Â  else if (line.includes('(STOP_TRACKING)')) type = 'STOP_TRACKING';
Â  Â  Â  else if (line.includes('(IDLE_WAKE)')) { type = 'IDLE_WAKE'; plain = 'User returned from idle.'; }
Â  Â  Â  else if (line.includes('(IDLE)') && !line.includes('IDLE_')) { type = 'IDLE'; plain = 'User went idle.'; }
Â  Â  Â  else if (line.includes('(START_BREAK)')) { type = 'START_BREAK'; plain = 'User started a break.'; }
Â  Â  Â  else if (line.includes('(STOP_BREAK)')) { type = 'STOP_BREAK'; plain = 'User ended a break.'; }
Â  Â  Â  else if (line.includes('(SHUTDOWN)')) { type = 'SHUTDOWN'; plain = 'App closed normally.'; }
Â  Â  Â  else if (line.includes('(LOCATIONS_STATUS)')) { 
Â  Â  Â  Â  type = 'LOCATIONS_STATUS'; 
Â  Â  Â  Â  if (line.includes('Authorized')) plain = 'ğŸ“ Location permissions granted.';
Â  Â  Â  Â  else if (line.includes('Denied') || line.includes('Restricted')) plain = 'ğŸ“ Location permissions denied or restricted.';
Â  Â  Â  Â  else plain = 'ğŸ“ Location permission status changed.';
Â  Â  Â  }
Â  Â  Â  else if (line.includes('Entered a geofence') || line.includes('Entered region')) { type = 'GEOFENCE_ENTER'; plain = 'ğŸ“ User entered a Job Site.'; }
Â  Â  Â  else if (line.includes('Exited region')) { type = 'GEOFENCE_EXIT'; plain = 'ğŸ“ User left a Job Site.'; }
Â  Â  Â  else if (line.includes('Discard=1')) { 
Â  Â  Â  Â  type = 'DISCARD'; 
Â  Â  Â  Â  if (line.includes('Timesheet is locked')) plain = 'ğŸ”’ Time rejected - timesheet is locked/approved.';
Â  Â  Â  Â  else if (line.includes('future')) plain = 'â° Time rejected - computer clock was set to the future.';
Â  Â  Â  Â  else if (line.includes('Duplicate')) plain = 'ğŸ“‹ Time rejected - duplicate record already exists.';
Â  Â  Â  Â  else if (line.includes('too large')) plain = 'ğŸ“Š Time rejected - time slot exceeded 10 minutes.';
Â  Â  Â  Â  else plain = 'âŒ Time was discarded/rejected by server.';
Â  Â  Â  }
Â  Â  Â  else if (line.includes('Network Error')) { type = 'NETWORK_ERROR'; plain = 'ğŸŒ Network error - could not connect to server.'; }
Â  Â  Â  else if (line.includes('Only injected input') || line.includes('was partially injected')) { type = 'INJECTED_INPUT'; plain = 'âš ï¸ Detected injected/simulated input activity.'; }
Â  Â  Â  else if (line.includes('Simulating missed input')) { type = 'SIMULATED_INPUT'; plain = 'âš ï¸ Input was simulated due to detection issue.'; }
Â  Â  Â  else if (line.includes('locked or screensaver active')) { type = 'SCREEN_LOCKED'; plain = 'ğŸ”’ Input discarded - screen was locked or screensaver active.'; }
Â  Â  Â  else if (line.includes('by [PROJECT_CONFIGURATION_LOCATION]')) { type = 'LEFT_JOBSITE'; plain = 'ğŸ“ Tracking stopped - user left required Job Site.'; }
Â  Â  Â  else if (line.includes('(STARTUP_CLEAN)')) { type = 'STARTUP_CLEAN'; plain = 'App opened normally.'; }
Â  Â  Â  else if (line.includes('(STARTUP_UNCLEAN)')) { type = 'STARTUP_UNCLEAN'; plain = 'App opened after crash/force quit.'; }
Â  Â  Â  else if (line.includes('(RESUME_DETECTED)')) {
Â  Â  Â  Â  type = 'RESUME_DETECTED'; plain = 'Found previous session to recover.';
Â  Â  Â  Â  const sm = line.match(/Start time:\s*(\d{4}-\d{2}-\d{2}\s\d{2}:\d{2}:\d{2})/);
Â  Â  Â  Â  const tzm = line.match(/([+-]\d{2}:?\d{2})/);
Â  Â  Â  Â  if (sm && tzm) {
Â  Â  Â  Â  Â  let tz = tzm[1]; if (!tz.includes(':')) tz = tz.slice(0,3)+':'+tz.slice(3);
Â  Â  Â  Â  Â  resumeStart = new Date(sm[1].replace(' ','T') + '.000' + tz);
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â  else if (line.includes('(RESUME_IGNORED)')) { type = 'RESUME_IGNORED'; plain = 'Previous session too old to recover.'; }
Â  Â  Â  else if (line.includes('(IDLE_ANSWER)')) {
Â  Â  Â  Â  type = 'IDLE_ANSWER';
Â  Â  Â  Â  const km = line.match(/KeepIdle:\s*(\d+)/), sm2 = line.match(/StopTracking:\s*(\d+)/);
Â  Â  Â  Â  if (km) keepIdle = parseInt(km[1]);
Â  Â  Â  Â  if (sm2) stopTrack = parseInt(sm2[1]);
Â  Â  Â  Â  plain = keepIdle === 1 ? 'User KEPT idle time.' : stopTrack === 1 ? 'User DISCARDED idle time.' : 'User responded to idle prompt.';
Â  Â  Â  }
Â  Â  Â  else if (line.toLowerCase().includes('sentry event')) { type = 'SENTRY'; plain = 'Crash reported to Sentry.'; }
Â  Â  Â  
Â  Â  Â  if (type === 'START_TRACKING' || type === 'STOP_TRACKING') {
Â  Â  Â  Â  const rm = line.match(/by \[([^\]]+)\]/);
Â  Â  Â  Â  reason = rm ? rm[1] : 'USER';
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  const fm = line.match(/(?:for|after)\s+(\d+)\s+seconds/i);
Â  Â  Â  if (fm) secs = parseInt(fm[1]);
Â  Â  Â  
Â  Â  Â  return { ts, type, reason, plain, secs, keepIdle, stopTrack, resumeStart, raw: line };
Â  Â  }
Â  Â  
Â  Â  function analyze(text) {
Â  Â  Â  const lines = text.split(/\r?\n/).map(l => l.trim()).filter(Boolean);
Â  Â  Â  const events = lines.map(parseLine).filter(e => e.ts && e.type).sort((a,b) => a.ts - b.ts);
Â  Â  Â  
Â  Â  Â  if (!events.length) return null;
Â  Â  Â  
Â  Â  Â  const warns = [], intervals = [], discarded = [];
Â  Â  Â  let open = null, lastResume = null;
Â  Â  Â  
Â  Â  Â  for (const e of events) {
Â  Â  Â  Â  if (e.type === 'RESUME_DETECTED') { lastResume = e; continue; }
Â  Â  Â  Â  if (e.type === 'RESUME_IGNORED') { lastResume = null; continue; }
Â  Â  Â  Â  if (['STARTUP_CLEAN','STARTUP_UNCLEAN','SENTRY'].includes(e.type)) continue;
Â  Â  Â  Â  
Â  Â  Â  Â  if (e.type === 'START_TRACKING') {
Â  Â  Â  Â  Â  if (open) warns.push({ type: 'UNCLOSED', msg: 'Unclosed START at ' + fmtTimeWithTz(open.ts), time: open.ts });
Â  Â  Â  Â  Â  if (e.reason === 'RESUMED' && lastResume?.resumeStart) {
Â  Â  Â  Â  Â  Â  e.ts = lastResume.resumeStart;
Â  Â  Â  Â  Â  Â  e.reason = 'RESUMED';
Â  Â  Â  Â  Â  Â  lastResume = null;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  open = e;
Â  Â  Â  Â  } else if (e.type === 'STOP_TRACKING' || e.type === 'SHUTDOWN') {
Â  Â  Â  Â  Â  if (!open) {
Â  Â  Â  Â  Â  Â  warns.push({ type: 'UNMATCHED', msg: 'Unmatched STOP at ' + fmtTimeWithTz(e.ts), time: e.ts });
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  intervals.push({ start: open.ts, stop: e.ts, secs: (e.ts - open.ts)/1000, startReason: open.reason || 'USER', stopReason: e.reason || (e.type === 'SHUTDOWN' ? 'SHUTDOWN' : 'USER') });
Â  Â  Â  Â  Â  Â  open = null;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  if (open) warns.push({ type: 'UNCLOSED', msg: 'Timer still running at ' + fmtTimeWithTz(open.ts), time: open.ts });
Â  Â  Â  
Â  Â  Â  // Sort intervals first
Â  Â  Â  intervals.sort((a,b) => a.start - b.start);
Â  Â  Â  
Â  Â  Â  // Detect quick start/stop (accidental double-click)
Â  Â  Â  for (let i = 0; i < intervals.length; i++) {
Â  Â  Â  Â  const it = intervals[i];
Â  Â  Â  Â  if (it.secs <= 5 && it.startReason === 'USER' && it.stopReason === 'USER') {
Â  Â  Â  Â  Â  warns.push({ 
Â  Â  Â  Â  Â  Â  type: 'QUICK_STARTSTOP', 
Â  Â  Â  Â  Â  Â  msg: `Quick start/stop at ${fmtTimeWithTz(it.start)} (${Math.round(it.secs)}s) - likely accidental double-click`,
Â  Â  Â  Â  Â  Â  time: it.start
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  // Detect stopped by configuration
Â  Â  Â  Â  if (it.stopReason === 'CONFIGURATION') {
Â  Â  Â  Â  Â  warns.push({
Â  Â  Â  Â  Â  Â  type: 'STOPPED_BY_CONFIG',
Â  Â  Â  Â  Â  Â  msg: `Tracking stopped by configuration at ${fmtTimeWithTz(it.stop)}`,
Â  Â  Â  Â  Â  Â  time: it.stop
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  // Detect crash events and calculate impact
Â  Â  Â  const crashes = events.filter(e => e.type === 'STARTUP_UNCLEAN');
Â  Â  Â  const resumes = events.filter(e => e.type === 'RESUME_DETECTED');
Â  Â  Â  const resumeIgnores = events.filter(e => e.type === 'RESUME_IGNORED');
Â  Â  Â  
Â  Â  Â  for (const crash of crashes) {
Â  Â  Â  Â  // Find if there was a resume or ignore after this crash
Â  Â  Â  Â  const resumeAfter = resumes.find(r => r.ts > crash.ts && r.ts - crash.ts < 60000); // within 1 min
Â  Â  Â  Â  const ignoreAfter = resumeIgnores.find(r => r.ts > crash.ts && r.ts - crash.ts < 60000);
Â  Â  Â  Â  
Â  Â  Â  Â  if (resumeAfter && resumeAfter.resumeStart) {
Â  Â  Â  Â  Â  // Calculate recovered time
Â  Â  Â  Â  Â  const recoveredSecs = (resumeAfter.ts - resumeAfter.resumeStart) / 1000;
Â  Â  Â  Â  Â  warns.push({
Â  Â  Â  Â  Â  Â  type: 'CRASH_RECOVERED',
Â  Â  Â  Â  Â  Â  msg: `App crashed at ${fmtTimeWithTz(crash.ts)} - successfully recovered ${fmtTime(recoveredSecs)} of tracking time`,
Â  Â  Â  Â  Â  Â  time: crash.ts,
Â  Â  Â  Â  Â  Â  recovered: recoveredSecs
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  } else if (ignoreAfter) {
Â  Â  Â  Â  Â  // Resume was ignored (too old)
Â  Â  Â  Â  Â  warns.push({
Â  Â  Â  Â  Â  Â  type: 'CRASH_TIME_LOST',
Â  Â  Â  Â  Â  Â  msg: `App crashed at ${fmtTimeWithTz(crash.ts)} - previous session was too old to recover (over 1 hour)`,
Â  Â  Â  Â  Â  Â  time: crash.ts
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  // Crash but no resume info - check if there was an open interval
Â  Â  Â  Â  Â  const unclosedStart = events.filter(e => e.type === 'START_TRACKING' && e.ts < crash.ts).pop();
Â  Â  Â  Â  Â  const matchingStop = events.find(e => (e.type === 'STOP_TRACKING' || e.type === 'SHUTDOWN') && e.ts > unclosedStart?.ts && e.ts < crash.ts);
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  if (unclosedStart && !matchingStop) {
Â  Â  Â  Â  Â  Â  const lostSecs = (crash.ts - unclosedStart.ts) / 1000;
Â  Â  Â  Â  Â  Â  warns.push({
Â  Â  Â  Â  Â  Â  Â  type: 'CRASH_TIME_LOST',
Â  Â  Â  Â  Â  Â  Â  msg: `App crashed at ${fmtTimeWithTz(crash.ts)} while tracking - potentially lost ~${fmtTime(lostSecs)} (check if time appears in dashboard)`,
Â  Â  Â  Â  Â  Â  Â  time: crash.ts,
Â  Â  Â  Â  Â  Â  Â  lost: lostSecs
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  warns.push({
Â  Â  Â  Â  Â  Â  Â  type: 'CRASH_NO_TRACKING',
Â  Â  Â  Â  Â  Â  Â  msg: `App crashed at ${fmtTimeWithTz(crash.ts)} - user was not tracking at the time`,
Â  Â  Â  Â  Â  Â  Â  time: crash.ts
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  let idleKept = 0, idleDisc = 0;
Â  Â  Â  const answers = events.filter(e => e.type === 'IDLE_ANSWER');
Â  Â  Â  for (const a of answers) {
Â  Â  Â  Â  const wake = events.filter(e => e.type === 'IDLE_WAKE' && e.ts < a.ts).pop();
Â  Â  Â  Â  if (wake?.secs) {
Â  Â  Â  Â  Â  if (a.keepIdle === 1) idleKept += wake.secs;
Â  Â  Â  Â  Â  else if (a.stopTrack === 1) {
Â  Â  Â  Â  Â  Â  idleDisc += wake.secs;
Â  Â  Â  Â  Â  Â  discarded.push({ start: new Date(wake.ts - wake.secs*1000), stop: wake.ts, secs: wake.secs });
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  const others = events.filter(e => !['START_TRACKING','STOP_TRACKING'].includes(e.type));
Â  Â  Â  
Â  Â  Â  return { intervals, discarded, warns, events: others, idleKept, idleDisc, allEvents: events };
Â  Â  }
Â  Â  
Â  Â  function hideInfoBox() {
Â  Â  Â  $('infoBox').style.display = 'none';
Â  Â  Â  if (selectedEl) { selectedEl.classList.remove('selected'); selectedEl = null; }
Â  Â  Â  document.querySelectorAll('tr.highlight').forEach(r => r.classList.remove('highlight'));
Â  Â  }
Â  Â  
Â  Â  function showInfoBox(e, title, content) {
Â  Â  Â  const box = $('infoBox');
Â  Â  Â  $('infoTitle').textContent = title;
Â  Â  Â  $('infoContent').innerHTML = content;
Â  Â  Â  box.style.display = 'block';
Â  Â  Â  
Â  Â  Â  let top = e.pageY - box.offsetHeight - 10;
Â  Â  Â  let left = e.pageX - box.offsetWidth / 2;
Â  Â  Â  if (top < window.scrollY + 10) top = e.pageY + 15;
Â  Â  Â  if (left < 10) left = 10;
Â  Â  Â  if (left + box.offsetWidth > window.innerWidth - 10) left = window.innerWidth - box.offsetWidth - 10;
Â  Â  Â  
Â  Â  Â  box.style.top = top + 'px';
Â  Â  Â  box.style.left = left + 'px';
Â  Â  }
Â  Â  
Â  Â  function render(data) {
Â  Â  Â  const plain = $('plainMode').checked;
Â  Â  Â  
Â  Â  Â  if (!data) {
Â  Â  Â  Â  $('kpiTotal').textContent = '0:00:00';
Â  Â  Â  Â  $('kpiIntervals').textContent = '0';
Â  Â  Â  Â  $('kpiIdleKept').textContent = '0:00:00';
Â  Â  Â  Â  $('kpiIdleDisc').textContent = '0:00:00';
Â  Â  Â  Â  $('kpiWarnings').textContent = '0';
Â  Â  Â  Â  $('intervalsBody').innerHTML = '';
Â  Â  Â  Â  $('eventsBody').innerHTML = '';
Â  Â  Â  Â  $('warningsList').innerHTML = '<li style="color:var(--muted)">No warnings</li>';
Â  Â  Â  Â  $('timelineSection').classList.remove('visible');
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  const total = data.intervals.reduce((s,i) => s + i.secs, 0);
Â  Â  Â  $('kpiTotal').textContent = fmtTime(total);
Â  Â  Â  $('kpiIntervals').textContent = data.intervals.length;
Â  Â  Â  $('kpiIdleKept').textContent = fmtTime(data.idleKept);
Â  Â  Â  $('kpiIdleDisc').textContent = fmtTime(data.idleDisc);
Â  Â  Â  $('kpiWarnings').textContent = data.warns.length;
Â  Â  Â  
Â  Â  Â  // Intervals table
Â  Â  Â  $('intervalsBody').innerHTML = data.intervals.map((it, i) => {
Â  Â  Â  Â  const stopCls = it.stopReason === 'USER' ? 'ok' : it.stopReason === 'IDLE' ? 'warn' : it.stopReason === 'SHUTDOWN' ? 'ok' : it.stopReason === 'CONFIGURATION' ? 'danger' : it.stopReason === 'PROJECT_CONFIGURATION_LOCATION' ? 'danger' : 'danger';
Â  Â  Â  Â  const startCls = it.startReason === 'RESUMED' ? 'resume' : it.startReason === 'IDLE' ? 'warn' : 'ok';
Â  Â  Â  Â  const isRecovered = it.startReason === 'RESUMED';
Â  Â  Â  Â  const rowStyle = isRecovered ? 'background: rgba(129,140,248,0.1);' : '';
Â  Â  Â  Â  const recoveredBadge = isRecovered ? ' <span class="tag resume">RECOVERED</span>' : '';
Â  Â  Â  Â  return `<tr id="row-${i}" style="${rowStyle}"><td>${i+1}${recoveredBadge}</td><td><span class="time-link" data-ts="${it.start.toISOString()}">${fmtTimeWithTz(it.start)}</span></td><td><span class="time-link" data-ts="${it.stop.toISOString()}">${fmtTimeWithTz(it.stop)}</span></td><td><span class="tag ok">${fmtTime(it.secs)}</span></td><td><span class="tag ${stopCls}">${it.stopReason}</span></td></tr>`;
Â  Â  Â  }).join('');
Â  Â  Â  
Â  Â  Â  // Add click handlers to time links
Â  Â  Â  $('intervalsBody').querySelectorAll('.time-link').forEach(el => {
Â  Â  Â  Â  el.addEventListener('click', () => snapToTime(el.dataset.ts));
Â  Â  Â  });
Â  Â  Â  
Â  Â  Â  // Events table - include crash warnings as events
Â  Â  Â  const crashWarns = data.warns.filter(w => w.type && w.type.startsWith('CRASH_'));
Â  Â  Â  const allEventsForTable = [...data.events];
Â  Â  Â  
Â  Â  Â  // Add crash warnings as synthetic events
Â  Â  Â  crashWarns.forEach(w => {
Â  Â  Â  Â  allEventsForTable.push({
Â  Â  Â  Â  Â  ts: w.time,
Â  Â  Â  Â  Â  type: w.type,
Â  Â  Â  Â  Â  plain: w.type === 'CRASH_RECOVERED' 
Â  Â  Â  Â  Â  Â  ? `âœ… App crashed but time was recovered successfully` 
Â  Â  Â  Â  Â  Â  : w.type === 'CRASH_TIME_LOST'
Â  Â  Â  Â  Â  Â  ? `âš ï¸ App crashed - some time may have been lost`
Â  Â  Â  Â  Â  Â  : w.type === 'CRASH_NO_TRACKING'
Â  Â  Â  Â  Â  Â  ? `â„¹ï¸ App crashed but user wasn't tracking`
Â  Â  Â  Â  Â  Â  : w.msg,
Â  Â  Â  Â  Â  isCrashEvent: true,
Â  Â  Â  Â  Â  recovered: w.recovered,
Â  Â  Â  Â  Â  lost: w.lost
Â  Â  Â  Â  });
Â  Â  Â  });
Â  Â  Â  
Â  Â  Â  // Sort by time
Â  Â  Â  allEventsForTable.sort((a, b) => a.ts - b.ts);
Â  Â  Â  
Â  Â  Â  $('eventsBody').innerHTML = allEventsForTable.map(e => {
Â  Â  Â  Â  let cls = 'tag';
Â  Â  Â  Â  let detail = plain && e.plain ? e.plain : e.type;
Â  Â  Â  Â  let rowStyle = '';
Â  Â  Â  Â  
Â  Â  Â  Â  if (e.isCrashEvent) {
Â  Â  Â  Â  Â  if (e.type === 'CRASH_RECOVERED') {
Â  Â  Â  Â  Â  Â  cls += ' ok';
Â  Â  Â  Â  Â  Â  rowStyle = 'background: rgba(34,197,94,0.15);';
Â  Â  Â  Â  Â  Â  if (plain && e.recovered) detail = `âœ… App crashed but recovered ${fmtTime(e.recovered)} of tracking time`;
Â  Â  Â  Â  Â  } else if (e.type === 'CRASH_TIME_LOST') {
Â  Â  Â  Â  Â  Â  cls += ' danger';
Â  Â  Â  Â  Â  Â  rowStyle = 'background: rgba(239,68,68,0.15);';
Â  Â  Â  Â  Â  Â  if (plain && e.lost) detail = `âš ï¸ App crashed - potentially lost ~${fmtTime(e.lost)}. Check dashboard.`;
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  cls += ' warn';
Â  Â  Â  Â  Â  Â  rowStyle = 'background: rgba(245,158,11,0.1);';
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  else if (e.type.includes('IDLE')) cls += ' warn';
Â  Â  Â  Â  else if (e.type === 'STARTUP_UNCLEAN' || e.type === 'SENTRY') { 
Â  Â  Â  Â  Â  cls += ' danger'; 
Â  Â  Â  Â  Â  rowStyle = 'background: rgba(239,68,68,0.1);';
Â  Â  Â  Â  Â  if (plain) detail = 'âš ï¸ ' + detail;
Â  Â  Â  Â  }
Â  Â  Â  Â  else if (e.type === 'RESUME_DETECTED') { 
Â  Â  Â  Â  Â  cls += ' resume'; 
Â  Â  Â  Â  Â  rowStyle = 'background: rgba(129,140,248,0.1);';
Â  Â  Â  Â  Â  if (plain && e.resumeStart) {
Â  Â  Â  Â  Â  Â  const recoveredSecs = (e.ts - e.resumeStart) / 1000;
Â  Â  Â  Â  Â  Â  detail = `âœ… Recovered ${fmtTime(recoveredSecs)} of tracking time (from ${fmtTimeWithTz(e.resumeStart)})`;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  else if (e.type === 'RESUME_IGNORED') {
Â  Â  Â  Â  Â  cls += ' warn';
Â  Â  Â  Â  Â  rowStyle = 'background: rgba(245,158,11,0.1);';
Â  Â  Â  Â  Â  if (plain) detail = 'âš ï¸ Previous session too old - time could not be recovered';
Â  Â  Â  Â  }
Â  Â  Â  Â  else if (e.type.includes('CLEAN') || e.type === 'SHUTDOWN') cls += ' ok';
Â  Â  Â  Â  
Â  Â  Â  Â  return `<tr style="${rowStyle}"><td>${fmtTimeWithTz(e.ts)}</td><td><span class="${cls}">${e.type}</span></td><td style="color:var(--muted);font-size:11px;">${detail}</td></tr>`;
Â  Â  Â  }).join('');
Â  Â  Â  
Â  Â  Â  // Warnings
Â  Â  Â  if (data.warns.length) {
Â  Â  Â  Â  $('warningsList').innerHTML = data.warns.map(w => {
Â  Â  Â  Â  Â  let msg, cls = '';
Â  Â  Â  Â  Â  const hasLearnMore = ['QUICK_STARTSTOP', 'CRASH_RECOVERED', 'CRASH_TIME_LOST', 'CRASH_NO_TRACKING', 'UNCLOSED', 'UNMATCHED', 'STOPPED_BY_CONFIG'].includes(w.type);
Â  Â  Â  Â  Â  const learnMoreBtn = hasLearnMore ? `<button class="learn-more-btn" data-type="${w.type}">Learn more</button>` : '';
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  if (plain) {
Â  Â  Â  Â  Â  Â  if (w.type === 'UNCLOSED') msg = 'Timer started but never stopped - likely a crash or still running.';
Â  Â  Â  Â  Â  Â  else if (w.type === 'UNMATCHED') msg = 'Stop found without matching start - log may be incomplete.';
Â  Â  Â  Â  Â  Â  else if (w.type === 'QUICK_STARTSTOP') msg = `âš¡ User likely double-clicked the record button at ${fmtTimeWithTz(w.time)} - timer started and stopped almost instantly.`;
Â  Â  Â  Â  Â  Â  else if (w.type === 'CRASH_RECOVERED') { msg = `âœ… App crashed at ${fmtTimeWithTz(w.time)} but time was recovered successfully.`; cls = 'color:var(--accent)'; }
Â  Â  Â  Â  Â  Â  else if (w.type === 'CRASH_TIME_LOST') { msg = `âš ï¸ App crashed at ${fmtTimeWithTz(w.time)} - some time may have been lost. Check the dashboard to confirm.`; cls = 'color:var(--warn)'; }
Â  Â  Â  Â  Â  Â  else if (w.type === 'CRASH_NO_TRACKING') msg = `â„¹ï¸ App crashed at ${fmtTimeWithTz(w.time)} but user wasn't tracking, so no time was lost.`;
Â  Â  Â  Â  Â  Â  else msg = w.msg;
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  msg = w.msg;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  return `<li style="${cls}"><span>${msg}</span>${learnMoreBtn}</li>`;
Â  Â  Â  Â  }).join('');
Â  Â  Â  } else {
Â  Â  Â  Â  $('warningsList').innerHTML = '<li style="color:var(--muted)">No warnings</li>';
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  // Add click handlers for learn more buttons
Â  Â  Â  $('warningsList').querySelectorAll('.learn-more-btn').forEach(btn => {
Â  Â  Â  Â  btn.addEventListener('click', () => showLearnMore(btn.dataset.type));
Â  Â  Â  });
Â  Â  Â  
Â  Â  Â  renderTimeline(data);
Â  Â  }
Â  Â  
Â  Â  function renderTimeline(data) {
Â  Â  Â  const all = [...data.intervals, ...data.discarded];
Â  Â  Â  if (!all.length) { $('timelineSection').classList.remove('visible'); return; }
Â  Â  Â  
Â  Â  Â  let min = new Date(8640000000000000), max = new Date(-8640000000000000);
Â  Â  Â  all.forEach(i => { if (i.start < min) min = i.start; if (i.stop > max) max = i.stop; });
Â  Â  Â  data.allEvents.forEach(e => { if (e.ts < min) min = e.ts; if (e.ts > max) max = e.ts; });
Â  Â  Â  
Â  Â  Â  min = new Date(min.getTime() - 5*60000);
Â  Â  Â  max = new Date(max.getTime() + 5*60000);
Â  Â  Â  timelineMin = min;
Â  Â  Â  timelineDur = max - min;
Â  Â  Â  
Â  Â  Â  const pos = t => ((t - min) / timelineDur) * 100;
Â  Â  Â  
Â  Â  Â  // Main track - intervals
Â  Â  Â  let mainHTML = '';
Â  Â  Â  data.intervals.forEach((it, idx) => {
Â  Â  Â  Â  const left = pos(it.start), width = Math.max(pos(it.stop) - left, 0.3);
Â  Â  Â  Â  const next = data.intervals[idx + 1];
Â  Â  Â  Â  const touching = next && (next.start - it.stop) < 2000;
Â  Â  Â  Â  mainHTML += `<div class="t-block ${it.startReason}" data-idx="${idx}" data-touching="${touching}" style="left:${left}%;width:${width}%"></div>`;
Â  Â  Â  });
Â  Â  Â  
Â  Â  Â  // Discarded
Â  Â  Â  data.discarded.forEach(d => {
Â  Â  Â  Â  const left = pos(d.start), width = Math.max(pos(d.stop) - left, 0.3);
Â  Â  Â  Â  mainHTML += `<div class="t-block DISCARDED" data-type="discarded" data-secs="${d.secs}" data-start="${fmtTimeWithTz(d.start)}" data-stop="${fmtTimeWithTz(d.stop)}" style="left:${left}%;width:${width}%"></div>`;
Â  Â  Â  });
Â  Â  Â  
Â  Â  Â  $('trackMain').innerHTML = mainHTML;
Â  Â  Â  
Â  Â  Â  // Events track
Â  Â  Â  let eventsHTML = '';
Â  Â  Â  data.allEvents.filter(e => ['STARTUP_CLEAN','STARTUP_UNCLEAN','SHUTDOWN','SENTRY'].includes(e.type)).forEach(e => {
Â  Â  Â  Â  let cls = 'shutdown', char = 'â—';
Â  Â  Â  Â  if (e.type === 'STARTUP_CLEAN') cls = 'clean';
Â  Â  Â  Â  else if (e.type === 'STARTUP_UNCLEAN') { cls = 'crash'; char = 'âœ–'; }
Â  Â  Â  Â  else if (e.type === 'SENTRY') cls = 'crash';
Â  Â  Â  Â  eventsHTML += `<div class="t-marker ${cls}" data-event="${e.type}" data-time="${fmtTimeWithTz(e.ts)}" data-plain="${e.plain}" style="left:${pos(e.ts)}%">${char}</div>`;
Â  Â  Â  });
Â  Â  Â  
Â  Â  Â  $('trackEvents').innerHTML = eventsHTML;
Â  Â  Â  $('timelineSection').classList.add('visible');
Â  Â  Â  
Â  Â  Â  // Add click handlers to blocks
Â  Â  Â  $('trackMain').querySelectorAll('.t-block').forEach(el => {
Â  Â  Â  Â  el.addEventListener('click', e => {
Â  Â  Â  Â  Â  e.stopPropagation();
Â  Â  Â  Â  Â  if (selectedEl === el) { hideInfoBox(); return; }
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  hideInfoBox();
Â  Â  Â  Â  Â  selectedEl = el;
Â  Â  Â  Â  Â  el.classList.add('selected');
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  const idx = el.dataset.idx;
Â  Â  Â  Â  Â  if (idx !== undefined) {
Â  Â  Â  Â  Â  Â  const it = data.intervals[parseInt(idx)];
Â  Â  Â  Â  Â  Â  const row = $('row-' + idx);
Â  Â  Â  Â  Â  Â  if (row) row.classList.add('highlight');
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  let content = `<p><span class="label">Start:</span> ${fmtTimeWithTz(it.start)}</p>`;
Â  Â  Â  Â  Â  Â  content += `<p><span class="label">Stop:</span> ${fmtTimeWithTz(it.stop)}</p>`;
Â  Â  Â  Â  Â  Â  content += `<p><span class="label">Duration:</span> ${fmtTime(it.secs)}</p>`;
Â  Â  Â  Â  Â  Â  content += `<p><span class="label">Started by:</span> ${it.startReason}</p>`;
Â  Â  Â  Â  Â  Â  content += `<p><span class="label">Stopped by:</span> ${it.stopReason}</p>`;
Â  Â  Â  Â  Â  Â  if (el.dataset.touching === 'true') {
Â  Â  Â  Â  Â  Â  Â  content += `<span class="touch-link" id="touchLink">Why are these bars touching?</span>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  showInfoBox(e, 'Tracking Interval', content);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (el.dataset.touching === 'true') {
Â  Â  Â  Â  Â  Â  Â  $('touchLink')?.addEventListener('click', () => $('touchModal').classList.add('visible'));
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  } else if (el.dataset.type === 'discarded') {
Â  Â  Â  Â  Â  Â  let content = `<p><span class="label">Start:</span> ${el.dataset.start}</p>`;
Â  Â  Â  Â  Â  Â  content += `<p><span class="label">Stop:</span> ${el.dataset.stop}</p>`;
Â  Â  Â  Â  Â  Â  content += `<p><span class="label">Duration:</span> ${fmtTime(parseInt(el.dataset.secs))}</p>`;
Â  Â  Â  Â  Â  Â  content += `<p><span class="label">Type:</span> Discarded idle time</p>`;
Â  Â  Â  Â  Â  Â  showInfoBox(e, 'Discarded Time', content);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  });
Â  Â  Â  
Â  Â  Â  // Add click handlers to markers
Â  Â  Â  $('trackEvents').querySelectorAll('.t-marker').forEach(el => {
Â  Â  Â  Â  el.addEventListener('click', e => {
Â  Â  Â  Â  Â  e.stopPropagation();
Â  Â  Â  Â  Â  if (selectedEl === el) { hideInfoBox(); return; }
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  hideInfoBox();
Â  Â  Â  Â  Â  selectedEl = el;
Â  Â  Â  Â  Â  el.classList.add('selected');
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  const plain = $('plainMode').checked;
Â  Â  Â  Â  Â  const content = `<p><span class="label">Event:</span> ${el.dataset.event}</p><p><span class="label">Time:</span> ${el.dataset.time}</p><p>${plain ? el.dataset.plain : ''}</p>`;
Â  Â  Â  Â  Â  showInfoBox(e, 'App Event', content);
Â  Â  Â  Â  });
Â  Â  Â  });
Â  Â  }
Â  Â  
Â  Â  // Event listeners
Â  Â  $('analyzeBtn').onclick = () => {
Â  Â  Â  result = analyze($('logInput').value);
Â  Â  Â  $('status').textContent = result ? `Found ${result.allEvents.length} events` : 'No valid events found';
Â  Â  Â  $('status').className = 'status ' + (result ? 'success' : 'error');
Â  Â  Â  render(result);
Â  Â  Â  hideInfoBox();
Â  Â  };
Â  Â  
Â  Â  $('clearBtn').onclick = () => {
Â  Â  Â  // Securely clear all data
Â  Â  Â  $('logInput').value = '';
Â  Â  Â  $('status').textContent = '';
Â  Â  Â  
Â  Â  Â  // Clear the result object
Â  Â  Â  if (result) {
Â  Â  Â  Â  // Overwrite arrays with empty arrays
Â  Â  Â  Â  if (result.intervals) result.intervals.length = 0;
Â  Â  Â  Â  if (result.discarded) result.discarded.length = 0;
Â  Â  Â  Â  if (result.warns) result.warns.length = 0;
Â  Â  Â  Â  if (result.events) result.events.length = 0;
Â  Â  Â  Â  if (result.allEvents) result.allEvents.length = 0;
Â  Â  Â  }
Â  Â  Â  result = null;
Â  Â  Â  
Â  Â  Â  // Clear timeline state
Â  Â  Â  timelineMin = null;
Â  Â  Â  timelineDur = null;
Â  Â  Â  focusRatio = null;
Â  Â  Â  selectedEl = null;
Â  Â  Â  
Â  Â  Â  // Clear rendered content
Â  Â  Â  render(null);
Â  Â  Â  hideInfoBox();
Â  Â  Â  
Â  Â  Â  // Show confirmation
Â  Â  Â  $('status').textContent = 'ğŸ”’ All data cleared from memory';
Â  Â  Â  $('status').className = 'status success';
Â  Â  Â  setTimeout(() => { $('status').textContent = ''; }, 3000);
Â  Â  Â  
Â  Â  Â  // Force garbage collection hint (browser may or may not act on this)
Â  Â  Â  if (window.gc) window.gc();
Â  Â  };
Â  Â  
Â  Â  $('plainMode').onchange = () => render(result);
Â  Â  
Â  Â  $('tzOffset').oninput = () => { updateTzLabel(); if ($('userTzMode').checked) render(result); };
Â  Â  $('userTzMode').onchange = () => {
Â  Â  Â  if ($('userTzMode').checked && userTzOffsetMs === null) {
Â  Â  Â  Â  $('tzOffset').focus();
Â  Â  Â  Â  $('tzOffset').style.borderColor = 'var(--warn)';
Â  Â  Â  Â  setTimeout(() => { $('tzOffset').style.borderColor = ''; }, 1500);
Â  Â  Â  }
Â  Â  Â  render(result);
Â  Â  };
Â  Â  
Â  Â  $('sampleBtn').onclick = () => {
Â  Â  Â  $('logInput').value = `2025-11-07 09:00:00 +0000 [AUDIT] (STARTUP_CLEAN) Startup
2025-11-07 09:05:00 +0000 [AUDIT] (START_TRACKING) Tracking Started: [Project:0] by [USER]
2025-11-07 09:30:00 +0000 [AUDIT] (STOP_TRACKING) Tracking Stopped: [Project:0] by [USER]
2025-11-07 10:00:00 +0000 [AUDIT] (START_TRACKING) Tracking Started: [Project:0] by [USER]
2025-11-07 10:00:02 +0000 [AUDIT] (STOP_TRACKING) Tracking Stopped: [Project:0] by [USER]
2025-11-07 10:01:00 +0000 [AUDIT] (START_TRACKING) Tracking Started: [Project:0] by [USER]
2025-11-07 10:30:00 +0000 [AUDIT] (IDLE) User went idle for 300 seconds
2025-11-07 10:35:00 +0000 [AUDIT] (IDLE_WAKE) User returned after 300 seconds
2025-11-07 10:35:10 +0000 [AUDIT] (IDLE_ANSWER) KeepIdle: 1 StopTracking: 0
2025-11-07 11:00:00 +0000 [AUDIT] (STOP_TRACKING) Tracking Stopped: [Project:0] by [USER]
2025-11-07 11:30:00 +0000 [AUDIT] (START_TRACKING) Tracking Started: [Project:0] by [USER]
2025-11-07 12:15:00 +0000 [AUDIT] (STARTUP_UNCLEAN) Startup
2025-11-07 12:15:01 +0000 [AUDIT] (RESUME_DETECTED) Detected resume. Start time: 2025-11-07 11:30:00 Duration: 0:45:00
2025-11-07 12:15:02 +0000 [AUDIT] (START_TRACKING) Tracking Started: [Project:0] by [RESUMED]
2025-11-07 13:00:00 +0000 [AUDIT] (STOP_TRACKING) Tracking Stopped: [Project:0] by [USER]
2025-11-07 13:01:00 +0000 [AUDIT] (SHUTDOWN) Shutdown client`;
Â  Â  Â  $('analyzeBtn').click();
Â  Â  };
Â  Â  
Â  Â  $('sampleLostBtn').onclick = () => {
Â  Â  Â  $('logInput').value = `2025-11-07 09:00:00 +0000 [AUDIT] (STARTUP_CLEAN) Startup
2025-11-07 09:05:00 +0000 [AUDIT] (START_TRACKING) Tracking Started: [Project:0] by [USER]
2025-11-07 09:30:00 +0000 [AUDIT] (STOP_TRACKING) Tracking Stopped: [Project:0] by [USER]
2025-11-07 10:00:00 +0000 [AUDIT] (START_TRACKING) Tracking Started: [Project:0] by [USER]
2025-11-07 12:30:00 +0000 [AUDIT] (STARTUP_UNCLEAN) Startup
2025-11-07 12:30:01 +0000 [AUDIT] (RESUME_IGNORED) Duration > 1 hours. Not auto resuming tracking. StartTime: 2025-11-07 10:00:00
2025-11-07 13:00:00 +0000 [AUDIT] (START_TRACKING) Tracking Started: [Project:0] by [USER]
2025-11-07 14:00:00 +0000 [AUDIT] (STOP_TRACKING) Tracking Stopped: [Project:0] by [USER]
2025-11-07 14:01:00 +0000 [AUDIT] (SHUTDOWN) Shutdown client`;
Â  Â  Â  $('analyzeBtn').click();
Â  Â  };
Â  Â  
Â  Â  // Zoom controls
Â  Â  $('zoomSlider').oninput = function() {
Â  Â  Â  const content = $('timelineContent');
Â  Â  Â  const container = $('timelineContainer');
Â  Â  Â  content.style.width = (this.value * 100) + '%';
Â  Â  Â  if (focusRatio !== null) {
Â  Â  Â  Â  container.scrollLeft = content.offsetWidth * focusRatio - container.offsetWidth / 2;
Â  Â  Â  }
Â  Â  };
Â  Â  
Â  Â  $('resetZoom').onclick = () => {
Â  Â  Â  $('zoomSlider').value = 1;
Â  Â  Â  $('timelineContent').style.width = '100%';
Â  Â  Â  $('timelineContainer').scrollLeft = 0;
Â  Â  Â  $('timelineCursor').style.display = 'none';
Â  Â  Â  focusRatio = null;
Â  Â  Â  hideInfoBox();
Â  Â  };
Â  Â  
Â  Â  // Timeline click for cursor
Â  Â  $('timelineContainer').onclick = e => {
Â  Â  Â  if (e.target.classList.contains('t-block') || e.target.classList.contains('t-marker')) return;
Â  Â  Â  hideInfoBox();
Â  Â  Â  
Â  Â  Â  const content = $('timelineContent');
Â  Â  Â  const rect = content.getBoundingClientRect();
Â  Â  Â  focusRatio = (e.clientX - rect.left) / rect.width;
Â  Â  Â  
Â  Â  Â  const cursor = $('timelineCursor');
Â  Â  Â  cursor.style.display = 'block';
Â  Â  Â  cursor.style.left = (focusRatio * 100) + '%';
Â  Â  };
Â  Â  
Â  Â  // Close info box on outside click
Â  Â  document.addEventListener('click', e => {
Â  Â  Â  if (!e.target.closest('.info-box') && !e.target.closest('.t-block') && !e.target.closest('.t-marker')) {
Â  Â  Â  Â  hideInfoBox();
Â  Â  Â  }
Â  Â  });
Â  Â  
Â  Â  // Modals
Â  Â  $('helpBtn').onclick = () => $('helpModal').classList.add('visible');
Â  Â  $('closeHelp').onclick = () => $('helpModal').classList.remove('visible');
Â  Â  $('helpModal').onclick = e => { if (e.target === $('helpModal')) $('helpModal').classList.remove('visible'); };
Â  Â  
Â  Â  $('closeLearnMore').onclick = () => $('learnMoreModal').classList.remove('visible');
Â  Â  $('learnMoreModal').onclick = e => { if (e.target === $('learnMoreModal')) $('learnMoreModal').classList.remove('visible'); };
Â  Â  
Â  Â  $('closeTouchModal').onclick = () => $('touchModal').classList.remove('visible');
Â  Â  $('touchModal').onclick = e => { if (e.target === $('touchModal')) $('touchModal').classList.remove('visible'); };
Â  Â  
Â  Â  // Learn more content for each warning type
Â  Â  const learnMoreData = {
Â  Â  Â  'QUICK_STARTSTOP': {
Â  Â  Â  Â  title: 'âš¡ Quick Start/Stop (Double-Click)',
Â  Â  Â  Â  content: `
Â  Â  Â  Â  Â  <h3>What happened?</h3>
Â  Â  Â  Â  Â  <p>The user started and stopped the timer within a few seconds. This is almost always an accidental double-click on the record button.</p>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>Likely causes</h3>
Â  Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  Â  <li><strong>Accidental double-click</strong> - User clicked the button twice quickly</li>
Â  Â  Â  Â  Â  Â  <li><strong>Laggy interface</strong> - App was slow to respond, so user clicked again</li>
Â  Â  Â  Â  Â  Â  <li><strong>Touchpad sensitivity</strong> - Trackpad registered multiple taps</li>
Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>What to tell the customer</h3>
Â  Â  Â  Â  Â  <p>The logs show the timer was started and stopped within a few seconds at [TIME]. This typically happens when the record button is clicked twice quickly. The user may not have noticed this happened.</p>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>Resolution</h3>
Â  Â  Â  Â  Â  <p>No action needed - this explains why time wasn't tracked. The user simply needs to click the record button once to start tracking.</p>
Â  Â  Â  Â  `
Â  Â  Â  },
Â  Â  Â  'CRASH_RECOVERED': {
Â  Â  Â  Â  title: 'âœ… Crash Recovered Successfully',
Â  Â  Â  Â  content: `
Â  Â  Â  Â  Â  <h3>What happened?</h3>
Â  Â  Â  Â  Â  <p>The app crashed or was force-closed while the user was tracking time, but when it restarted, it successfully recovered the tracking session.</p>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>What this means</h3>
Â  Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  Â  <li><strong>No time was lost</strong> - The resume feature worked correctly</li>
Â  Â  Â  Â  Â  Â  <li><strong>Time was preserved</strong> - The original start time was restored</li>
Â  Â  Â  Â  Â  Â  <li><strong>Tracking continued</strong> - User could continue where they left off</li>
Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>Likely causes of the crash</h3>
Â  Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  Â  <li>System ran out of memory</li>
Â  Â  Â  Â  Â  Â  <li>Operating system update forced restart</li>
Â  Â  Â  Â  Â  Â  <li>Power failure or laptop battery died</li>
Â  Â  Â  Â  Â  Â  <li>User accidentally force-quit the app</li>
Â  Â  Â  Â  Â  Â  <li>App bug (check for Sentry events)</li>
Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>What to tell the customer</h3>
Â  Â  Â  Â  Â  <p>Good news! Although the app crashed at [TIME], the time was automatically recovered. No tracking time was lost.</p>
Â  Â  Â  Â  `
Â  Â  Â  },
Â  Â  Â  'CRASH_TIME_LOST': {
Â  Â  Â  Â  title: 'âš ï¸ Crash - Time May Be Lost',
Â  Â  Â  Â  content: `
Â  Â  Â  Â  Â  <h3>What happened?</h3>
Â  Â  Â  Â  Â  <p>The app crashed while the user was tracking, and the time could not be automatically recovered.</p>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>Why wasn't time recovered?</h3>
Â  Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  Â  <li><strong>Too much time passed</strong> - If more than 1 hour passed (desktop) or 8 hours (mobile) before the app restarted, the session is considered too old</li>
Â  Â  Â  Â  Â  Â  <li><strong>Resume data corrupted</strong> - The saved session data may have been damaged</li>
Â  Â  Â  Â  Â  Â  <li><strong>App reinstalled</strong> - Reinstalling the app clears saved session data</li>
Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>What to check</h3>
Â  Â  Â  Â  Â  <ol>
Â  Â  Â  Â  Â  Â  <li><strong>Check the dashboard</strong> - Some time may have been uploaded before the crash</li>
Â  Â  Â  Â  Â  Â  <li><strong>Look for activity data</strong> - Check if any 10-minute slots were saved</li>
Â  Â  Â  Â  Â  Â  <li><strong>Calculate the gap</strong> - Time between last successful upload and crash</li>
Â  Â  Â  Â  Â  </ol>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>What to tell the customer</h3>
Â  Â  Â  Â  Â  <p>The app crashed at [TIME] while tracking was active. Unfortunately, the tracking session couldn't be automatically recovered because [REASON]. Some time may have been saved before the crash - please check your dashboard. Any missing time would need to be added manually.</p>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>Prevention</h3>
Â  Â  Â  Â  Â  <p>Share article: <em>Computer shutdown, crash and power outages while tracking time</em></p>
Â  Â  Â  Â  `
Â  Â  Â  },
Â  Â  Â  'CRASH_NO_TRACKING': {
Â  Â  Â  Â  title: 'â„¹ï¸ Crash - No Time Lost',
Â  Â  Â  Â  content: `
Â  Â  Â  Â  Â  <h3>What happened?</h3>
Â  Â  Â  Â  Â  <p>The app crashed or was force-closed, but the user wasn't actively tracking time at that moment.</p>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>What this means</h3>
Â  Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  Â  <li><strong>No time was lost</strong> - User wasn't tracking when crash occurred</li>
Â  Â  Â  Â  Â  Â  <li><strong>No action needed</strong> - This is informational only</li>
Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>Likely causes</h3>
Â  Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  Â  <li>System restart or update</li>
Â  Â  Â  Â  Â  Â  <li>User force-quit the app</li>
Â  Â  Â  Â  Â  Â  <li>App bug while idle</li>
Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>What to tell the customer</h3>
Â  Â  Â  Â  Â  <p>The app did restart unexpectedly at [TIME], but you weren't tracking time at that moment, so no time was lost.</p>
Â  Â  Â  Â  `
Â  Â  Â  },
Â  Â  Â  'UNCLOSED': {
Â  Â  Â  Â  title: 'ğŸ”´ Unclosed Start (No Stop Found)',
Â  Â  Â  Â  content: `
Â  Â  Â  Â  Â  <h3>What happened?</h3>
Â  Â  Â  Â  Â  <p>The logs show a START_TRACKING event without a matching STOP_TRACKING event.</p>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>Likely causes</h3>
Â  Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  Â  <li><strong>App crashed</strong> - Most common cause. Look for STARTUP_UNCLEAN after this</li>
Â  Â  Â  Â  Â  Â  <li><strong>Still tracking</strong> - The timer might still be running right now</li>
Â  Â  Â  Â  Â  Â  <li><strong>Incomplete logs</strong> - The log file may have been cut off or rotated</li>
Â  Â  Â  Â  Â  Â  <li><strong>System shutdown</strong> - Computer was shut down without closing the app properly</li>
Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>What to check</h3>
Â  Â  Â  Â  Â  <ol>
Â  Â  Â  Â  Â  Â  <li>Is there a STARTUP_UNCLEAN event after this? (indicates crash)</li>
Â  Â  Â  Â  Â  Â  <li>Is there a RESUME_DETECTED event? (time may have been recovered)</li>
Â  Â  Â  Â  Â  Â  <li>Are the logs complete? Request fresh logs if needed</li>
Â  Â  Â  Â  Â  Â  <li>Check if the user is currently tracking</li>
Â  Â  Â  Â  Â  </ol>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>What to tell the customer</h3>
Â  Â  Â  Â  Â  <p>The logs show tracking started at [TIME] but no stop event was recorded. This usually means the app crashed. Let me check if the time was recovered...</p>
Â  Â  Â  Â  `
Â  Â  Â  },
Â  Â  Â  'UNMATCHED': {
Â  Â  Â  Â  title: 'ğŸŸ¡ Unmatched Stop',
Â  Â  Â  Â  content: `
Â  Â  Â  Â  Â  <h3>What happened?</h3>
Â  Â  Â  Â  Â  <p>The logs show a STOP_TRACKING event without a matching START_TRACKING event before it.</p>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>Likely causes</h3>
Â  Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  Â  <li><strong>Incomplete logs</strong> - The START event may be in an older log file that wasn't included</li>
Â  Â  Â  Â  Â  Â  <li><strong>Log rotation</strong> - hubstaff.log files rotate when they get too large, older events may be lost</li>
Â  Â  Â  Â  Â  Â  <li><strong>Logs requested too late</strong> - The relevant log entries may have been deleted</li>
Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  <h3>What to check</h3>
Â  Â  Â  Â  Â  <ol>
Â  Â  Â  Â  Â  Â  <li>Do you have all the log files? (hubstaff.log, hubstaff.1, hubstaff.2, etc.)</li>
Â  Â  Â  Â  Â  Â  <li>Request fresh logs closer to when the issue occurred</li>
Â  Â  Â  Â  Â  Â  <li>Check the audit.log specifically - it's more compact</li>
Â  Â  Â  Â  Â  </ol>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>What to tell the customer</h3>
Â  Â  Â  Â  Â  <p>The log file appears to be incomplete - I can see when tracking stopped but not when it started. Could you reproduce the issue and send fresh logs right after it happens?</p>
Â  Â  Â  Â  `
Â  Â  Â  },
Â  Â  Â  'STOPPED_BY_CONFIG': {
Â  Â  Â  Â  title: 'âš™ï¸ Tracking Stopped by Configuration',
Â  Â  Â  Â  content: `
Â  Â  Â  Â  Â  <h3>What happened?</h3>
Â  Â  Â  Â  Â  <p>The timer was automatically stopped by the system due to a configuration setting or limit being reached. The user did not manually stop tracking.</p>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>Likely causes</h3>
Â  Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  Â  <li><strong>User was removed from project</strong> - An admin removed the user from the project they were tracking to</li>
Â  Â  Â  Â  Â  Â  <li><strong>Project time tracking limit reached</strong> - The project has a maximum hours limit that was hit</li>
Â  Â  Â  Â  Â  Â  <li><strong>Project budget reached</strong> - The project's budget allocation has been exhausted</li>
Â  Â  Â  Â  Â  Â  <li><strong>Weekly time limit reached</strong> - The user's weekly tracking limit was reached</li>
Â  Â  Â  Â  Â  Â  <li><strong>Daily time limit reached</strong> - The user's daily tracking limit was reached</li>
Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>What to check</h3>
Â  Â  Â  Â  Â  <ol>
Â  Â  Â  Â  Â  Â  <li><strong>Project membership</strong> - Is the user still a member of the project?</li>
Â  Â  Â  Â  Â  Â  <li><strong>Project limits</strong> - Check project settings for any time/budget limits</li>
Â  Â  Â  Â  Â  Â  <li><strong>User limits</strong> - Check if the user has weekly/daily limits configured</li>
Â  Â  Â  Â  Â  Â  <li><strong>Organization settings</strong> - Check for any organization-wide limits</li>
Â  Â  Â  Â  Â  </ol>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>What to tell the customer</h3>
Â  Â  Â  Â  Â  <p>The logs show that tracking was automatically stopped at [TIME] due to a system configuration. This typically happens when a time limit or budget has been reached, or if there was a change to project membership. Let me check your account settings to identify the specific cause...</p>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>Resolution</h3>
Â  Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  Â  <li>If limit reached: Admin can adjust or reset the limit</li>
Â  Â  Â  Â  Â  Â  <li>If removed from project: Admin needs to re-add user to the project</li>
Â  Â  Â  Â  Â  Â  <li>If budget reached: Admin needs to increase budget or move to a new budget period</li>
Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  `
Â  Â  Â  },
Â  Â  Â  'LEFT_JOBSITE': {
Â  Â  Â  Â  title: 'ğŸ“ Left Required Job Site',
Â  Â  Â  Â  content: `
Â  Â  Â  Â  Â  <h3>What happened?</h3>
Â  Â  Â  Â  Â  <p>Tracking was automatically stopped because the user left a Job Site that is required for the project they were tracking to.</p>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>How Job Sites work</h3>
Â  Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  Â  <li>Some projects require users to be physically at a specific location (Job Site) to track time</li>
Â  Â  Â  Â  Â  Â  <li>The app uses GPS/location services to detect when the user enters or exits the Job Site</li>
Â  Â  Â  Â  Â  Â  <li>If the user leaves the Job Site boundary, tracking automatically stops</li>
Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>Likely causes</h3>
Â  Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  Â  <li><strong>User physically left the location</strong> - They drove/walked away from the Job Site</li>
Â  Â  Â  Â  Â  Â  <li><strong>GPS drift</strong> - Poor GPS signal caused the phone to think they left</li>
Â  Â  Â  Â  Â  Â  <li><strong>Job Site radius too small</strong> - The geofence boundary is set too tight</li>
Â  Â  Â  Â  Â  Â  <li><strong>Location permissions changed</strong> - User may have revoked location access</li>
Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>What to check</h3>
Â  Â  Â  Â  Â  <ol>
Â  Â  Â  Â  Â  Â  <li>Was the user actually at the Job Site when tracking stopped?</li>
Â  Â  Â  Â  Â  Â  <li>Check the Job Site radius settings - is it large enough?</li>
Â  Â  Â  Â  Â  Â  <li>Check device location permissions</li>
Â  Â  Â  Â  Â  Â  <li>Look for <code>LOCATIONS_STATUS</code> events in the logs</li>
Â  Â  Â  Â  Â  </ol>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>What to tell the customer</h3>
Â  Â  Â  Â  Â  <p>The logs show tracking stopped at [TIME] because the app detected you left the required Job Site. If you were still physically at the location, this could be due to GPS signal issues. Check that location services are enabled and try moving to an area with better GPS reception.</p>
Â  Â  Â  Â  `
Â  Â  Â  },
Â  Â  Â  'DISCARD': {
Â  Â  Â  Â  title: 'ğŸ”´ Time Rejected by Server',
Â  Â  Â  Â  content: `
Â  Â  Â  Â  Â  <h3>What happened?</h3>
Â  Â  Â  Â  Â  <p>The Hubstaff server rejected time that the app tried to upload. This means the tracked time will NOT appear in reports/dashboard.</p>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>Common reasons (Discard=1)</h3>
Â  Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  Â  <li><strong>Timesheet is locked</strong> - The timesheet for this period has been approved and cannot be edited</li>
Â  Â  Â  Â  Â  Â  <li><strong>Time slot in the future</strong> - The computer's clock was set incorrectly (ahead of real time)</li>
Â  Â  Â  Â  Â  Â  <li><strong>Duplicate record</strong> - This time was already uploaded previously</li>
Â  Â  Â  Â  Â  Â  <li><strong>Tracked is too large</strong> - A time slot exceeded 10 minutes (should never happen normally)</li>
Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>What to check</h3>
Â  Â  Â  Â  Â  <ol>
Â  Â  Â  Â  Â  Â  <li>Look at the specific <code>Discard=1 message:</code> in the logs for the exact reason</li>
Â  Â  Â  Â  Â  Â  <li>Check if the timesheet for that date is locked/approved</li>
Â  Â  Â  Â  Â  Â  <li>Verify the user's computer clock is set correctly</li>
Â  Â  Â  Â  Â  Â  <li>Check the dashboard to see what time actually recorded</li>
Â  Â  Â  Â  Â  </ol>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>What to tell the customer</h3>
Â  Â  Â  Â  Â  <p>The server rejected some tracked time because [REASON]. Unfortunately, discarded time cannot be recovered automatically. The user may need to add this time manually if their timesheet is not locked.</p>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>Prevention</h3>
Â  Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  Â  <li>Ensure computer clock is set to automatic</li>
Â  Â  Â  Â  Â  Â  <li>Submit timesheets before approval deadlines</li>
Â  Â  Â  Â  Â  Â  <li>Check for the timezone mismatch error article</li>
Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  `
Â  Â  Â  },
Â  Â  Â  'NETWORK_ERROR': {
Â  Â  Â  Â  title: 'ğŸŒ Network Error',
Â  Â  Â  Â  content: `
Â  Â  Â  Â  Â  <h3>What happened?</h3>
Â  Â  Â  Â  Â  <p>The app could not connect to Hubstaff servers to upload tracking data.</p>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>Likely causes</h3>
Â  Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  Â  <li><strong>No internet connection</strong> - WiFi/ethernet disconnected</li>
Â  Â  Â  Â  Â  Â  <li><strong>Firewall blocking</strong> - Corporate firewall blocking Hubstaff</li>
Â  Â  Â  Â  Â  Â  <li><strong>Antivirus interference</strong> - Security software blocking the connection</li>
Â  Â  Â  Â  Â  Â  <li><strong>Server outage</strong> - Hubstaff servers temporarily unavailable</li>
Â  Â  Â  Â  Â  Â  <li><strong>VPN issues</strong> - VPN causing connection problems</li>
Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>What this means for tracked time</h3>
Â  Â  Â  Â  Â  <p>The app queues data locally when network errors occur. Once connection is restored, it should upload automatically. However, if the app crashes before uploading, some data could be lost.</p>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>What to check</h3>
Â  Â  Â  Â  Â  <ol>
Â  Â  Â  Â  Â  Â  <li>Did the time eventually appear in the dashboard?</li>
Â  Â  Â  Â  Â  Â  <li>Were there many network errors in a row?</li>
Â  Â  Â  Â  Â  Â  <li>Is there a firewall or antivirus that might block Hubstaff?</li>
Â  Â  Â  Â  Â  </ol>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>What to tell the customer</h3>
Â  Â  Â  Â  Â  <p>The logs show network errors at [TIME] which prevented data from uploading immediately. The app normally retries automatically. Please check if the time eventually appeared in your dashboard. If not, there may be a firewall or network issue preventing connection to Hubstaff servers.</p>
Â  Â  Â  Â  `
Â  Â  Â  },
Â  Â  Â  'INJECTED_INPUT': {
Â  Â  Â  Â  title: 'âš ï¸ Injected Input Detected',
Â  Â  Â  Â  content: `
Â  Â  Â  Â  Â  <h3>What happened?</h3>
Â  Â  Â  Â  Â  <p>The app detected that keyboard/mouse input came from an "injected" source rather than actual physical input devices.</p>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>What "injected input" means</h3>
Â  Â  Â  Â  Â  <p>Windows can detect when input comes from:</p>
Â  Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  Â  <li><strong>Real input (R)</strong> - Actual keyboard/mouse from the user</li>
Â  Â  Â  Â  Â  Â  <li><strong>Injected input (I)</strong> - Software-generated input from any process</li>
Â  Â  Â  Â  Â  Â  <li><strong>Low-integrity injected (LI)</strong> - Input from unverified/untrusted sources</li>
Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>Possible causes</h3>
Â  Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  Â  <li><strong>Legitimate software</strong> - Remote desktop, accessibility tools, automation software</li>
Â  Â  Â  Â  Â  Â  <li><strong>Hardware issues</strong> - Faulty USB port or device causing false signals</li>
Â  Â  Â  Â  Â  Â  <li><strong>Activity simulation</strong> - Software designed to fake activity (cheating)</li>
Â  Â  Â  Â  Â  Â  <li><strong>Mouse/keyboard software</strong> - Gaming mice/keyboards with macro features</li>
Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>What to check</h3>
Â  Â  Â  Â  Â  <ol>
Â  Â  Â  Â  Â  Â  <li>Is the user using remote desktop or screen sharing?</li>
Â  Â  Â  Â  Â  Â  <li>Do they have accessibility software installed?</li>
Â  Â  Â  Â  Â  Â  <li>Is this happening consistently or occasionally?</li>
Â  Â  Â  Â  Â  Â  <li>Check the activity percentages - are they unusually high?</li>
Â  Â  Â  Â  Â  </ol>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>Important note</h3>
Â  Â  Â  Â  Â  <p>Injected input is NOT automatically cheating. Many legitimate tools inject input. Look for patterns like: consistently 100% activity, same screenshots repeating, injected input with no real input at all.</p>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>What to tell the customer</h3>
Â  Â  Â  Â  Â  <p>The logs show some activity was detected as "injected" rather than direct keyboard/mouse input. This can happen with remote desktop software, accessibility tools, or certain hardware. If you're using any such software, this is expected behavior.</p>
Â  Â  Â  Â  `
Â  Â  Â  },
Â  Â  Â  'SIMULATED_INPUT': {
Â  Â  Â  Â  title: 'âš ï¸ Simulated Input',
Â  Â  Â  Â  content: `
Â  Â  Â  Â  Â  <h3>What happened?</h3>
Â  Â  Â  Â  Â  <p>The app detected that input occurred but couldn't determine the exact source, so it "simulated" that input was received.</p>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>Why this happens</h3>
Â  Â  Â  Â  Â  <p>On Windows, there are multiple ways to detect input. When the highly accurate method doesn't see input, but the OS reports activity occurred, the app simulates that both mouse and keyboard input happened.</p>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>Common causes</h3>
Â  Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  Â  <li><strong>Skype video calls</strong> - Skype can interfere with input detection</li>
Â  Â  Â  Â  Â  Â  <li><strong>Certain applications</strong> - Some apps don't report input normally</li>
Â  Â  Â  Â  Â  Â  <li><strong>Driver issues</strong> - Input device drivers not reporting correctly</li>
Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>Is this cheating?</h3>
Â  Â  Â  Â  Â  <p><strong>Usually no.</strong> Simulated input is the app compensating for detection limitations, not evidence of fake activity. It means "we know something happened but couldn't see exactly what."</p>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>What to tell the customer</h3>
Â  Â  Â  Â  Â  <p>The logs show some input was detected indirectly. This is usually caused by certain applications interfering with activity detection and is not a cause for concern. The activity was still real - the app just couldn't determine if it was keyboard or mouse.</p>
Â  Â  Â  Â  `
Â  Â  Â  },
Â  Â  Â  'SCREEN_LOCKED': {
Â  Â  Â  Â  title: 'ğŸ”’ Screen Locked / Screensaver Active',
Â  Â  Â  Â  content: `
Â  Â  Â  Â  Â  <h3>What happened?</h3>
Â  Â  Â  Â  Â  <p>The app detected that the computer screen was locked or the screensaver was active, so it discarded any input signals during this time.</p>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>Why input is discarded</h3>
Â  Â  Â  Â  Â  <p>When the screen is locked, any detected "input" is likely false signals (not real user activity), so the app ignores it to maintain accurate activity tracking.</p>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>Impact on tracking</h3>
Â  Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  Â  <li>Time may still be tracked (if timer was running)</li>
Â  Â  Â  Â  Â  Â  <li>Activity percentage will be 0% during locked period</li>
Â  Â  Â  Â  Â  Â  <li>This may trigger idle detection if locked for too long</li>
Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>What to tell the customer</h3>
Â  Â  Â  Â  Â  <p>The logs show the screen was locked or screensaver was active at [TIME]. During this time, activity is recorded as 0% because you weren't actively using the computer. If the idle timeout was reached, you would have seen the idle prompt when you returned.</p>
Â  Â  Â  Â  `
Â  Â  Â  },
Â  Â  Â  'LOCATION_DENIED': {
Â  Â  Â  Â  title: 'ğŸ“ Location Permissions Denied',
Â  Â  Â  Â  content: `
Â  Â  Â  Â  Â  <h3>What happened?</h3>
Â  Â  Â  Â  Â  <p>The device's location permissions for Hubstaff were denied or restricted.</p>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>Impact</h3>
Â  Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  Â  <li><strong>Job Sites won't work</strong> - App can't detect when user enters/exits locations</li>
Â  Â  Â  Â  Â  Â  <li><strong>Auto-start won't work</strong> - If project requires location, tracking can't start automatically</li>
Â  Â  Â  Â  Â  Â  <li><strong>May stop tracking</strong> - If currently tracking a location-required project</li>
Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>Required permission level</h3>
Â  Â  Â  Â  Â  <p>For Job Sites to work correctly, the app needs:</p>
Â  Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  Â  <li><strong>iOS:</strong> "Always" location permission</li>
Â  Â  Â  Â  Â  Â  <li><strong>Android:</strong> "Allow all the time" location permission</li>
Â  Â  Â  Â  Â  Â  <li><strong>Accuracy:</strong> Full/Precise (not approximate)</li>
Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>What to check</h3>
Â  Â  Â  Â  Â  <ol>
Â  Â  Â  Â  Â  Â  <li>Device Settings â†’ Apps â†’ Hubstaff â†’ Permissions â†’ Location</li>
Â  Â  Â  Â  Â  Â  <li>Ensure it's set to "Always" not "While using" or "Never"</li>
Â  Â  Â  Â  Â  Â  <li>Check that precise/accurate location is enabled</li>
Â  Â  Â  Â  Â  </ol>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <h3>What to tell the customer</h3>
Â  Â  Â  Â  Â  <p>The logs show location permissions were denied or changed at [TIME]. For Job Sites to work, Hubstaff needs "Always" location permission. Please check your device settings and ensure location access is set to "Always" with precise accuracy enabled.</p>
Â  Â  Â  Â  `
Â  Â  Â  }
Â  Â  };
Â  Â  
Â  Â  function showLearnMore(type) {
Â  Â  Â  const data = learnMoreData[type];
Â  Â  Â  if (!data) return;
Â  Â  Â  
Â  Â  Â  $('learnMoreTitle').textContent = data.title;
Â  Â  Â  Â  // Replace [TIME] placeholder in all content blocks
Â  Â  Â  Â  // Note: This is an approximation. If we had the specific log entry for the warning, we could use that.
Â  Â  Â  Â  const firstWarning = result.warns.find(w => w.type === type);
Â  Â  Â  Â  const timeString = firstWarning ? fmtTimeWithTz(firstWarning.time) : '[A specific time]';
Â  Â  Â  Â  const reason = firstWarning?.msg || '[A general reason]';

Â  Â  Â  Â  let content = data.content.replace(/\[TIME\]/g, timeString);
Â  Â  Â  Â  content = content.replace(/\[REASON\]/g, reason);

Â  Â  Â  $('learnMoreContent').innerHTML = content;
Â  Â  Â  $('learnMoreModal').classList.add('visible');
Â  Â  }
Â  Â  
Â  Â  $('privacyBtn').onclick = () => $('privacyModal').classList.add('visible');
Â  Â  $('closePrivacy').onclick = () => $('privacyModal').classList.remove('visible');
Â  Â  $('privacyModal').onclick = e => { if (e.target === $('privacyModal')) $('privacyModal').classList.remove('visible'); };
Â  Â  
Â  Â  // Clear data when page is closed/navigated away
Â  Â  window.addEventListener('beforeunload', () => {
Â  Â  Â  $('logInput').value = '';
Â  Â  Â  if (result) {
Â  Â  Â  Â  if (result.intervals) result.intervals.length = 0;
Â  Â  Â  Â  if (result.discarded) result.discarded.length = 0;
Â  Â  Â  Â  if (result.warns) result.warns.length = 0;
Â  Â  Â  Â  if (result.events) result.events.length = 0;
Â  Â  Â  Â  if (result.allEvents) result.allEvents.length = 0;
Â  Â  Â  }
Â  Â  Â  result = null;
Â  Â  });
Â  Â  
Â  Â  // Keyboard shortcut - Cmd/Ctrl + Enter to analyze
Â  Â  document.addEventListener('keydown', e => {
Â  Â  Â  if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') {
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  $('analyzeBtn').click();
Â  Â  Â  }
Â  Â  });
Â  Â  
Â  Â  // Snap to time function
Â  Â  function snapToTime(isoString) {
Â  Â  Â  if (!timelineMin || !timelineDur) return;
Â  Â  Â  
Â  Â  Â  const targetTime = new Date(isoString);
Â  Â  Â  if (isNaN(targetTime.getTime())) return;
Â  Â  Â  
Â  Â  Â  const ratio = (targetTime - timelineMin) / timelineDur;
Â  Â  Â  if (ratio < 0 || ratio > 1) return;
Â  Â  Â  
Â  Â  Â  focusRatio = ratio;
Â  Â  Â  
Â  Â  Â  // Zoom in to 10x
Â  Â  Â  $('zoomSlider').value = 10;
Â  Â  Â  const content = $('timelineContent');
Â  Â  Â  const container = $('timelineContainer');
Â  Â  Â  content.style.width = '1000%';
Â  Â  Â  
Â  Â  Â  // Show and position cursor
Â  Â  Â  const cursor = $('timelineCursor');
Â  Â  Â  cursor.style.display = 'block';
Â  Â  Â  cursor.style.left = (ratio * 100) + '%';
Â  Â  Â  
Â  Â  Â  // Scroll to center on the cursor
Â  Â  Â  container.scrollLeft = content.offsetWidth * ratio - container.offsetWidth / 2;
Â  Â  Â  
Â  Â  Â  // Flash effect
Â  Â  Â  cursor.style.boxShadow = '0 0 15px 3px yellow';
Â  Â  Â  setTimeout(() => { cursor.style.boxShadow = '0 0 6px var(--danger)'; }, 500);
Â  Â  }
Â  </script>
</body>
</html>
